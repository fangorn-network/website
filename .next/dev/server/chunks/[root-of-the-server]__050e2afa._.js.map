{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/app/api/storacha-delegation/%5Bdid%5D/route.ts"],"sourcesContent":["import * as Client from '@storacha/client'\nimport { StoreMemory } from '@storacha/client/stores/memory'\nimport * as Proof from '@storacha/client/proof'\nimport { Signer } from '@storacha/client/principal/ed25519'\nimport * as DID from '@ipld/dag-ucan/did'\nimport type { ServiceAbility } from '@storacha/client'\n\nexport async function GET(\n    request: Request,\n    { params }: { params: { did: string } }\n) {\n    const { did } = await params\n\n    const principal = Signer.parse(process.env.NEXT_PUBLIC_STORAGE_PRIVATE_KEY || '')\n    const store = new StoreMemory()\n    const client = await Client.create({ principal, store })\n\n    const proof = await Proof.parse(process.env.NEXT_PUBLIC_STORAGE_PROOF || '')\n    const space = await client.addSpace(proof)\n    await client.setCurrentSpace(space.did())\n\n    // Delegate to the user's agent\n    const audience = DID.parse(did)\n    const abilities: ServiceAbility[] = [\n        'space/blob/add',\n        'space/index/add',\n        'filecoin/offer',\n        'upload/add'\n    ]\n\n    const expiration = Math.floor(Date.now() / 1000) + 60 * 60 // 1 hour\n\n    const delegation = await client.createDelegation(audience, abilities, { expiration })\n    const archive = await delegation.archive()\n\n    if (!archive.ok) {\n        return new Response('Failed to create delegation', { status: 500 })\n    }\n\n    return new Response(Buffer.from(archive.ok), {\n        headers: { 'Content-Type': 'application/octet-stream' }\n    })\n}"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;;;;;;AAGO,eAAe,IAClB,OAAgB,EAChB,EAAE,MAAM,EAA+B;IAEvC,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM;IAEtB,MAAM,YAAY,mKAAM,CAAC,KAAK,CAAC,qIAA+C;IAC9E,MAAM,QAAQ,IAAI,0LAAW;IAC7B,MAAM,SAAS,MAAM,yLAAa,CAAC;QAAE;QAAW;IAAM;IAEtD,MAAM,QAAQ,MAAM,gKAAW,CAAC,g3EAAyC;IACzE,MAAM,QAAQ,MAAM,OAAO,QAAQ,CAAC;IACpC,MAAM,OAAO,eAAe,CAAC,MAAM,GAAG;IAEtC,+BAA+B;IAC/B,MAAM,WAAW,8JAAS,CAAC;IAC3B,MAAM,YAA8B;QAChC;QACA;QACA;QACA;KACH;IAED,MAAM,aAAa,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,KAAK,GAAG,SAAS;;IAEpE,MAAM,aAAa,MAAM,OAAO,gBAAgB,CAAC,UAAU,WAAW;QAAE;IAAW;IACnF,MAAM,UAAU,MAAM,WAAW,OAAO;IAExC,IAAI,CAAC,QAAQ,EAAE,EAAE;QACb,OAAO,IAAI,SAAS,+BAA+B;YAAE,QAAQ;QAAI;IACrE;IAEA,OAAO,IAAI,SAAS,OAAO,IAAI,CAAC,QAAQ,EAAE,GAAG;QACzC,SAAS;YAAE,gBAAgB;QAA2B;IAC1D;AACJ"}}]
}