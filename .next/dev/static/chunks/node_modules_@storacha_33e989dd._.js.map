{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/equals.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/equals.ts"],"sourcesContent":["/**\n * Returns true if the two passed Uint8Arrays have the same content\n */\nexport function equals (a: Uint8Array, b: Uint8Array): boolean {\n  if (a === b) {\n    return true\n  }\n\n  if (a.byteLength !== b.byteLength) {\n    return false\n  }\n\n  for (let i = 0; i < a.byteLength; i++) {\n    if (a[i] !== b[i]) {\n      return false\n    }\n  }\n\n  return true\n}\n"],"names":[],"mappings":"AAAA;;GAEG;;;;AACG,SAAU,MAAM,CAAE,CAAa,EAAE,CAAa;IAClD,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACZ,OAAO,IAAI,CAAA;IACb,CAAC;IAED,IAAI,CAAC,CAAC,UAAU,KAAK,CAAC,CAAC,UAAU,EAAE,CAAC;QAClC,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC,EAAE,CAAE,CAAC;QACtC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAClB,OAAO,KAAK,CAAA;QACd,CAAC;IACH,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/alloc.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/alloc.ts"],"sourcesContent":["/**\n * Returns a `Uint8Array` of the requested size. Referenced memory will\n * be initialized to 0.\n */\nexport function alloc (size: number = 0): Uint8Array {\n  return new Uint8Array(size)\n}\n\n/**\n * Where possible returns a Uint8Array of the requested size that references\n * uninitialized memory. Only use if you are certain you will immediately\n * overwrite every value in the returned `Uint8Array`.\n */\nexport function allocUnsafe (size: number = 0): Uint8Array {\n  return new Uint8Array(size)\n}\n"],"names":[],"mappings":"AAAA;;;GAGG;;;;;;AACG,SAAU,KAAK,CAAE,OAAe,CAAC;IACrC,OAAO,IAAI,UAAU,CAAC,IAAI,CAAC,CAAA;AAC7B,CAAC;AAOK,SAAU,WAAW,CAAE,OAAe,CAAC;IAC3C,OAAO,IAAI,UAAU,CAAC,IAAI,CAAC,CAAA;AAC7B,CAAC"}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/util/as-uint8array.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/util/as-uint8array.ts"],"sourcesContent":["/**\n * To guarantee Uint8Array semantics, convert nodejs Buffers\n * into vanilla Uint8Arrays\n */\nexport function asUint8Array (buf: Uint8Array): Uint8Array {\n  return buf\n}\n"],"names":[],"mappings":"AAAA;;;GAGG;;;;AACG,SAAU,YAAY,CAAE,GAAe;IAC3C,OAAO,GAAG,CAAA;AACZ,CAAC"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/xor.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/xor.ts"],"sourcesContent":["import { allocUnsafe } from '#alloc'\nimport { asUint8Array } from '#util/as-uint8array'\n\n/**\n * Returns the xor distance between two Uint8Arrays\n */\nexport function xor (a: Uint8Array, b: Uint8Array): Uint8Array {\n  if (a.length !== b.length) {\n    throw new Error('Inputs should have the same length')\n  }\n\n  const result = allocUnsafe(a.length)\n\n  for (let i = 0; i < a.length; i++) {\n    result[i] = a[i] ^ b[i]\n  }\n\n  return asUint8Array(result)\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;AACpC,OAAO,EAAE,YAAY,EAAE,MAAM,qBAAqB,CAAA;;;AAK5C,SAAU,GAAG,CAAE,CAAa,EAAE,CAAa;IAC/C,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC;QAC1B,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAA;IACvD,CAAC;IAED,MAAM,MAAM,OAAG,6MAAW,EAAC,CAAC,CAAC,MAAM,CAAC,CAAA;IAEpC,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;QAClC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IACzB,CAAC;IAED,WAAO,iOAAY,EAAC,MAAM,CAAC,CAAA;AAC7B,CAAC"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/compare.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/compare.ts"],"sourcesContent":["/**\n * Can be used with Array.sort to sort and array with Uint8Array entries\n */\nexport function compare (a: Uint8Array, b: Uint8Array): number {\n  for (let i = 0; i < a.byteLength; i++) {\n    if (a[i] < b[i]) {\n      return -1\n    }\n\n    if (a[i] > b[i]) {\n      return 1\n    }\n  }\n\n  if (a.byteLength > b.byteLength) {\n    return 1\n  }\n\n  if (a.byteLength < b.byteLength) {\n    return -1\n  }\n\n  return 0\n}\n"],"names":[],"mappings":"AAAA;;GAEG;;;;AACG,SAAU,OAAO,CAAE,CAAa,EAAE,CAAa;IACnD,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC,EAAE,CAAE,CAAC;QACtC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAChB,OAAO,CAAC,CAAC,CAAA;QACX,CAAC;QAED,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAChB,OAAO,CAAC,CAAA;QACV,CAAC;IACH,CAAC;IAED,IAAI,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC;QAChC,OAAO,CAAC,CAAA;IACV,CAAC;IAED,IAAI,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC;QAChC,OAAO,CAAC,CAAC,CAAA;IACX,CAAC;IAED,OAAO,CAAC,CAAA;AACV,CAAC"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/concat.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/concat.ts"],"sourcesContent":["import { allocUnsafe } from '#alloc'\nimport { asUint8Array } from '#util/as-uint8array'\n\n/**\n * Returns a new Uint8Array created by concatenating the passed Uint8Arrays\n */\nexport function concat (arrays: Uint8Array[], length?: number): Uint8Array {\n  if (length == null) {\n    length = arrays.reduce((acc, curr) => acc + curr.length, 0)\n  }\n\n  const output = allocUnsafe(length)\n  let offset = 0\n\n  for (const arr of arrays) {\n    output.set(arr, offset)\n    offset += arr.length\n  }\n\n  return asUint8Array(output)\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;AACpC,OAAO,EAAE,YAAY,EAAE,MAAM,qBAAqB,CAAA;;;AAK5C,SAAU,MAAM,CAAE,MAAoB,EAAE,MAAe;IAC3D,IAAI,MAAM,IAAI,IAAI,EAAE,CAAC;QACnB,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,CAAG,CAAD,EAAI,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAA;IAC7D,CAAC;IAED,MAAM,MAAM,OAAG,6MAAW,EAAC,MAAM,CAAC,CAAA;IAClC,IAAI,MAAM,GAAG,CAAC,CAAA;IAEd,KAAK,MAAM,GAAG,IAAI,MAAM,CAAE,CAAC;QACzB,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA;QACvB,MAAM,IAAI,GAAG,CAAC,MAAM,CAAA;IACtB,CAAC;IAED,WAAO,iOAAY,EAAC,MAAM,CAAC,CAAA;AAC7B,CAAC"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/util/bases.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/util/bases.ts"],"sourcesContent":["import { bases } from 'multiformats/basics'\nimport type { MultibaseCodec } from 'multiformats'\nimport { allocUnsafe } from '#alloc'\n\nfunction createCodec (name: string, prefix: string, encode: (buf: Uint8Array) => string, decode: (str: string) => Uint8Array): MultibaseCodec<any> {\n  return {\n    name,\n    prefix,\n    encoder: {\n      name,\n      prefix,\n      encode\n    },\n    decoder: {\n      decode\n    }\n  }\n}\n\nconst string = createCodec('utf8', 'u', (buf) => {\n  const decoder = new TextDecoder('utf8')\n  return 'u' + decoder.decode(buf)\n}, (str) => {\n  const encoder = new TextEncoder()\n  return encoder.encode(str.substring(1))\n})\n\nconst ascii = createCodec('ascii', 'a', (buf) => {\n  let string = 'a'\n\n  for (let i = 0; i < buf.length; i++) {\n    string += String.fromCharCode(buf[i])\n  }\n  return string\n}, (str) => {\n  str = str.substring(1)\n  const buf = allocUnsafe(str.length)\n\n  for (let i = 0; i < str.length; i++) {\n    buf[i] = str.charCodeAt(i)\n  }\n\n  return buf\n})\n\nexport type SupportedEncodings = 'utf8' | 'utf-8' | 'hex' | 'latin1' | 'ascii' | 'binary' | keyof typeof bases\n\nconst BASES: Record<SupportedEncodings, MultibaseCodec<any>> = {\n  utf8: string,\n  'utf-8': string,\n  hex: bases.base16,\n  latin1: ascii,\n  ascii,\n  binary: ascii,\n\n  ...bases\n}\n\nexport default BASES\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,KAAK,EAAE,MAAM,qBAAqB,CAAA;AAE3C,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;;;AAEpC,SAAS,WAAW,CAAE,IAAY,EAAE,MAAc,EAAE,MAAmC,EAAE,MAAmC;IAC1H,OAAO;QACL,IAAI;QACJ,MAAM;QACN,OAAO,EAAE;YACP,IAAI;YACJ,MAAM;YACN,MAAM;SACP;QACD,OAAO,EAAE;YACP,MAAM;SACP;KACF,CAAA;AACH,CAAC;AAED,MAAM,MAAM,GAAG,WAAW,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE;IAC9C,MAAM,OAAO,GAAG,IAAI,WAAW,CAAC,MAAM,CAAC,CAAA;IACvC,OAAO,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;AAClC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;IACT,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE,CAAA;IACjC,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAA;AACzC,CAAC,CAAC,CAAA;AAEF,MAAM,KAAK,GAAG,WAAW,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE;IAC9C,IAAI,MAAM,GAAG,GAAG,CAAA;IAEhB,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;QACpC,MAAM,IAAI,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IACvC,CAAC;IACD,OAAO,MAAM,CAAA;AACf,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;IACT,GAAG,GAAG,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAA;IACtB,MAAM,GAAG,OAAG,6MAAW,EAAC,GAAG,CAAC,MAAM,CAAC,CAAA;IAEnC,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;QACpC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAA;IAC5B,CAAC;IAED,OAAO,GAAG,CAAA;AACZ,CAAC,CAAC,CAAA;AAIF,MAAM,KAAK,GAAoD;IAC7D,IAAI,EAAE,MAAM;IACZ,OAAO,EAAE,MAAM;IACf,GAAG,EAAE,iLAAK,CAAC,MAAM;IACjB,MAAM,EAAE,KAAK;IACb,KAAK;IACL,MAAM,EAAE,KAAK;IAEb,GAAG,iLAAK;CACT,CAAA;uCAEc,KAAK,CAAA"}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/from-string.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/from-string.ts"],"sourcesContent":["import bases, { type SupportedEncodings } from './util/bases.js'\n\nexport type { SupportedEncodings }\n\n/**\n * Create a `Uint8Array` from the passed string\n *\n * Supports `utf8`, `utf-8`, `hex`, and any encoding supported by the multiformats module.\n *\n * Also `ascii` which is similar to node's 'binary' encoding.\n */\nexport function fromString (string: string, encoding: SupportedEncodings = 'utf8'): Uint8Array {\n  const base = bases[encoding]\n\n  if (base == null) {\n    throw new Error(`Unsupported encoding \"${encoding}\"`)\n  }\n\n  // add multibase prefix\n  return base.decoder.decode(`${base.prefix}${string}`) // eslint-disable-line @typescript-eslint/restrict-template-expressions\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,KAAK,EAAE,EAA2B,MAAM,iBAAiB,CAAA;;AAW1D,SAAU,UAAU,CAAE,MAAc,EAAE,WAA+B,MAAM;IAC/E,MAAM,IAAI,GAAG,iNAAK,CAAC,QAAQ,CAAC,CAAA;IAE5B,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC;QACjB,MAAM,IAAI,KAAK,CAAC,CAAA,sBAAA,EAAyB,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAA;IACvD,CAAC;IAED,uBAAuB;IACvB,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAA,CAAC,uEAAuE;AAC/H,CAAC"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/to-string.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/to-string.ts"],"sourcesContent":["import bases, { type SupportedEncodings } from './util/bases.js'\n\nexport type { SupportedEncodings }\n\n/**\n * Turns a `Uint8Array` into a string.\n *\n * Supports `utf8`, `utf-8` and any encoding supported by the multibase module.\n *\n * Also `ascii` which is similar to node's 'binary' encoding.\n */\nexport function toString (array: Uint8Array, encoding: SupportedEncodings = 'utf8'): string {\n  const base = bases[encoding]\n\n  if (base == null) {\n    throw new Error(`Unsupported encoding \"${encoding}\"`)\n  }\n\n  // strip multibase prefix\n  return base.encoder.encode(array).substring(1)\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,KAAK,EAAE,EAA2B,MAAM,iBAAiB,CAAA;;AAW1D,SAAU,QAAQ,CAAE,KAAiB,EAAE,WAA+B,MAAM;IAChF,MAAM,IAAI,GAAG,iNAAK,CAAC,QAAQ,CAAC,CAAA;IAE5B,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC;QACjB,MAAM,IAAI,KAAK,CAAC,CAAA,sBAAA,EAAyB,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAA;IACvD,CAAC;IAED,yBAAyB;IACzB,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAA;AAChD,CAAC"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/access/node_modules/uint8arrays/dist/src/index.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/node_modules/uint8arrays/src/index.ts"],"sourcesContent":["/**\n * @packageDocumentation\n *\n * `Uint8Array`s bring memory-efficient(ish) byte handling to browsers - they are similar to Node.js `Buffer`s but lack a lot of the utility methods present on that class.\n *\n * This module exports a number of function that let you do common operations - joining Uint8Arrays together, seeing if they have the same contents etc.\n *\n * Since Node.js `Buffer`s are also `Uint8Array`s, it falls back to `Buffer` internally where it makes sense for performance reasons.\n *\n * ## alloc(size)\n *\n * Create a new `Uint8Array`. When running under Node.js, `Buffer` will be used in preference to `Uint8Array`.\n *\n * ### Example\n *\n * ```js\n * import { alloc } from 'uint8arrays/alloc'\n *\n * const buf = alloc(100)\n * ```\n *\n * ## allocUnsafe(size)\n *\n * Create a new `Uint8Array`. When running under Node.js, `Buffer` will be used in preference to `Uint8Array`.\n *\n * On platforms that support it, memory referenced by the returned `Uint8Array` will not be initialized.\n *\n * ### Example\n *\n * ```js\n * import { allocUnsafe } from 'uint8arrays/alloc'\n *\n * const buf = allocUnsafe(100)\n * ```\n *\n * ## compare(a, b)\n *\n * Compare two `Uint8Arrays`\n *\n * ### Example\n *\n * ```js\n * import { compare } from 'uint8arrays/compare'\n *\n * const arrays = [\n *   Uint8Array.from([3, 4, 5]),\n *   Uint8Array.from([0, 1, 2])\n * ]\n *\n * const sorted = arrays.sort(compare)\n *\n * console.info(sorted)\n * // [\n * //    Uint8Array[0, 1, 2]\n * //    Uint8Array[3, 4, 5]\n * // ]\n * ```\n *\n * ## concat(arrays, \\[length])\n *\n * Concatenate one or more `Uint8Array`s and return a `Uint8Array` with their contents.\n *\n * If you know the length of the arrays, pass it as a second parameter, otherwise it will be calculated by traversing the list of arrays.\n *\n * ### Example\n *\n * ```js\n * import { concat } from 'uint8arrays/concat'\n *\n * const arrays = [\n *   Uint8Array.from([0, 1, 2]),\n *   Uint8Array.from([3, 4, 5])\n * ]\n *\n * const all = concat(arrays, 6)\n *\n * console.info(all)\n * // Uint8Array[0, 1, 2, 3, 4, 5]\n * ```\n *\n * ## equals(a, b)\n *\n * Returns true if the two arrays are the same array or if they have the same length and contents.\n *\n * ### Example\n *\n * ```js\n * import { equals } from 'uint8arrays/equals'\n *\n * const a = Uint8Array.from([0, 1, 2])\n * const b = Uint8Array.from([3, 4, 5])\n * const c = Uint8Array.from([0, 1, 2])\n *\n * console.info(equals(a, b)) // false\n * console.info(equals(a, c)) // true\n * console.info(equals(a, a)) // true\n * ```\n *\n * ## fromString(string, encoding = 'utf8')\n *\n * Returns a new `Uint8Array` created from the passed string and interpreted as the passed encoding.\n *\n * Supports `utf8` and any of the [multibase encodings](https://github.com/multiformats/multibase/blob/master/multibase.csv) as implemented by the [multiformats module](https://www.npmjs.com/package/multiformats).\n *\n * ### Example\n *\n * ```js\n * import { fromString } from 'uint8arrays/from-string'\n *\n * console.info(fromString('hello world')) // Uint8Array[104, 101 ...\n * console.info(fromString('00010203aabbcc', 'base16')) // Uint8Array[0, 1 ...\n * console.info(fromString('AAECA6q7zA', 'base64')) // Uint8Array[0, 1 ...\n * console.info(fromString('01234', 'ascii')) // Uint8Array[48, 49 ...\n * ```\n *\n * ## toString(array, encoding = 'utf8')\n *\n * Returns a string created from the passed `Uint8Array` in the passed encoding.\n *\n * Supports `utf8` and any of the [multibase encodings](https://github.com/multiformats/multibase/blob/master/multibase.csv) as implemented by the [multiformats module](https://www.npmjs.com/package/multiformats).\n *\n * ### Example\n *\n * ```js\n * import { toString } from 'uint8arrays/to-string'\n *\n * console.info(toString(Uint8Array.from([104, 101...]))) // 'hello world'\n * console.info(toString(Uint8Array.from([0, 1, 2...]), 'base16')) // '00010203aabbcc'\n * console.info(toString(Uint8Array.from([0, 1, 2...]), 'base64')) // 'AAECA6q7zA'\n * console.info(toString(Uint8Array.from([48, 49, 50...]), 'ascii')) // '01234'\n * ```\n *\n * ## xor(a, b)\n *\n * Returns a `Uint8Array` containing `a` and `b` xored together.\n *\n * ### Example\n *\n * ```js\n * import { xor } from 'uint8arrays/xor'\n *\n * console.info(xor(Uint8Array.from([1, 0]), Uint8Array.from([0, 1]))) // Uint8Array[1, 1]\n * ```\n *\n * ## xorCompare(a, b)\n *\n * Compares the distances between two xor `Uint8Array`s.\n *\n * ### Example\n *\n * ```ts\n * import { xor } from 'uint8arrays/xor'\n * import { xorCompare } from 'uint8arrays/xor-compare'\n *\n * const target = Uint8Array.from([1, 1])\n * const val1 = Uint8Array.from([1, 0])\n * const xor1 = xor(target, val1)\n *\n * const val2 = Uint8Array.from([0, 1])\n * const xor2 = xor(target, val2)\n *\n * console.info(xorCompare(xor1, xor2)) // -1 or 0 or 1\n * ```\n */\n\nimport { equals } from './equals.js'\nimport { xor } from './xor.js'\nimport { compare } from '#compare'\nimport { concat } from '#concat'\nimport { fromString } from '#from-string'\nimport { toString } from '#to-string'\n\nexport {\n  compare,\n  concat,\n  equals,\n  fromString,\n  toString,\n  xor\n}\n\nexport type { SupportedEncodings } from './util/bases.js'\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAmKG;AAEH,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAA;AACpC,OAAO,EAAE,GAAG,EAAE,MAAM,UAAU,CAAA;AAC9B,OAAO,EAAE,OAAO,EAAE,MAAM,UAAU,CAAA;AAClC,OAAO,EAAE,MAAM,EAAE,MAAM,SAAS,CAAA;AAChC,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAA;AACzC,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAA"}},
    {"offset": {"line": 410, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/equals.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/equals.ts"],"sourcesContent":["/**\n * Returns true if the two passed Uint8Arrays have the same content\n */\nexport function equals (a: Uint8Array, b: Uint8Array): boolean {\n  if (a === b) {\n    return true\n  }\n\n  if (a.byteLength !== b.byteLength) {\n    return false\n  }\n\n  for (let i = 0; i < a.byteLength; i++) {\n    if (a[i] !== b[i]) {\n      return false\n    }\n  }\n\n  return true\n}\n"],"names":[],"mappings":"AAAA;;GAEG;;;;AACG,SAAU,MAAM,CAAE,CAAa,EAAE,CAAa;IAClD,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;QACZ,OAAO,IAAI,CAAA;IACb,CAAC;IAED,IAAI,CAAC,CAAC,UAAU,KAAK,CAAC,CAAC,UAAU,EAAE,CAAC;QAClC,OAAO,KAAK,CAAA;IACd,CAAC;IAED,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC,EAAE,CAAE,CAAC;QACtC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAClB,OAAO,KAAK,CAAA;QACd,CAAC;IACH,CAAC;IAED,OAAO,IAAI,CAAA;AACb,CAAC"}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/alloc.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/alloc.ts"],"sourcesContent":["/**\n * Returns a `Uint8Array` of the requested size. Referenced memory will\n * be initialized to 0.\n */\nexport function alloc (size: number = 0): Uint8Array {\n  return new Uint8Array(size)\n}\n\n/**\n * Where possible returns a Uint8Array of the requested size that references\n * uninitialized memory. Only use if you are certain you will immediately\n * overwrite every value in the returned `Uint8Array`.\n */\nexport function allocUnsafe (size: number = 0): Uint8Array {\n  return new Uint8Array(size)\n}\n"],"names":[],"mappings":"AAAA;;;GAGG;;;;;;AACG,SAAU,KAAK,CAAE,OAAe,CAAC;IACrC,OAAO,IAAI,UAAU,CAAC,IAAI,CAAC,CAAA;AAC7B,CAAC;AAOK,SAAU,WAAW,CAAE,OAAe,CAAC;IAC3C,OAAO,IAAI,UAAU,CAAC,IAAI,CAAC,CAAA;AAC7B,CAAC"}},
    {"offset": {"line": 453, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/util/as-uint8array.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/util/as-uint8array.ts"],"sourcesContent":["/**\n * To guarantee Uint8Array semantics, convert nodejs Buffers\n * into vanilla Uint8Arrays\n */\nexport function asUint8Array (buf: Uint8Array): Uint8Array {\n  return buf\n}\n"],"names":[],"mappings":"AAAA;;;GAGG;;;;AACG,SAAU,YAAY,CAAE,GAAe;IAC3C,OAAO,GAAG,CAAA;AACZ,CAAC"}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/xor.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/xor.ts"],"sourcesContent":["import { allocUnsafe } from '#alloc'\nimport { asUint8Array } from '#util/as-uint8array'\n\n/**\n * Returns the xor distance between two Uint8Arrays\n */\nexport function xor (a: Uint8Array, b: Uint8Array): Uint8Array {\n  if (a.length !== b.length) {\n    throw new Error('Inputs should have the same length')\n  }\n\n  const result = allocUnsafe(a.length)\n\n  for (let i = 0; i < a.length; i++) {\n    result[i] = a[i] ^ b[i]\n  }\n\n  return asUint8Array(result)\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;AACpC,OAAO,EAAE,YAAY,EAAE,MAAM,qBAAqB,CAAA;;;AAK5C,SAAU,GAAG,CAAE,CAAa,EAAE,CAAa;IAC/C,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC;QAC1B,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAA;IACvD,CAAC;IAED,MAAM,MAAM,OAAG,oNAAW,EAAC,CAAC,CAAC,MAAM,CAAC,CAAA;IAEpC,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;QAClC,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IACzB,CAAC;IAED,WAAO,wOAAY,EAAC,MAAM,CAAC,CAAA;AAC7B,CAAC"}},
    {"offset": {"line": 489, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/compare.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/compare.ts"],"sourcesContent":["/**\n * Can be used with Array.sort to sort and array with Uint8Array entries\n */\nexport function compare (a: Uint8Array, b: Uint8Array): number {\n  for (let i = 0; i < a.byteLength; i++) {\n    if (a[i] < b[i]) {\n      return -1\n    }\n\n    if (a[i] > b[i]) {\n      return 1\n    }\n  }\n\n  if (a.byteLength > b.byteLength) {\n    return 1\n  }\n\n  if (a.byteLength < b.byteLength) {\n    return -1\n  }\n\n  return 0\n}\n"],"names":[],"mappings":"AAAA;;GAEG;;;;AACG,SAAU,OAAO,CAAE,CAAa,EAAE,CAAa;IACnD,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC,EAAE,CAAE,CAAC;QACtC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAChB,OAAO,CAAC,CAAC,CAAA;QACX,CAAC;QAED,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAChB,OAAO,CAAC,CAAA;QACV,CAAC;IACH,CAAC;IAED,IAAI,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC;QAChC,OAAO,CAAC,CAAA;IACV,CAAC;IAED,IAAI,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,UAAU,EAAE,CAAC;QAChC,OAAO,CAAC,CAAC,CAAA;IACX,CAAC;IAED,OAAO,CAAC,CAAA;AACV,CAAC"}},
    {"offset": {"line": 516, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/concat.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/concat.ts"],"sourcesContent":["import { allocUnsafe } from '#alloc'\nimport { asUint8Array } from '#util/as-uint8array'\n\n/**\n * Returns a new Uint8Array created by concatenating the passed Uint8Arrays\n */\nexport function concat (arrays: Uint8Array[], length?: number): Uint8Array {\n  if (length == null) {\n    length = arrays.reduce((acc, curr) => acc + curr.length, 0)\n  }\n\n  const output = allocUnsafe(length)\n  let offset = 0\n\n  for (const arr of arrays) {\n    output.set(arr, offset)\n    offset += arr.length\n  }\n\n  return asUint8Array(output)\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;AACpC,OAAO,EAAE,YAAY,EAAE,MAAM,qBAAqB,CAAA;;;AAK5C,SAAU,MAAM,CAAE,MAAoB,EAAE,MAAe;IAC3D,IAAI,MAAM,IAAI,IAAI,EAAE,CAAC;QACnB,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,CAAG,CAAD,EAAI,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAA;IAC7D,CAAC;IAED,MAAM,MAAM,OAAG,oNAAW,EAAC,MAAM,CAAC,CAAA;IAClC,IAAI,MAAM,GAAG,CAAC,CAAA;IAEd,KAAK,MAAM,GAAG,IAAI,MAAM,CAAE,CAAC;QACzB,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAA;QACvB,MAAM,IAAI,GAAG,CAAC,MAAM,CAAA;IACtB,CAAC;IAED,WAAO,wOAAY,EAAC,MAAM,CAAC,CAAA;AAC7B,CAAC"}},
    {"offset": {"line": 540, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/util/bases.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/util/bases.ts"],"sourcesContent":["import { bases } from 'multiformats/basics'\nimport type { MultibaseCodec } from 'multiformats'\nimport { allocUnsafe } from '#alloc'\n\nfunction createCodec (name: string, prefix: string, encode: (buf: Uint8Array) => string, decode: (str: string) => Uint8Array): MultibaseCodec<any> {\n  return {\n    name,\n    prefix,\n    encoder: {\n      name,\n      prefix,\n      encode\n    },\n    decoder: {\n      decode\n    }\n  }\n}\n\nconst string = createCodec('utf8', 'u', (buf) => {\n  const decoder = new TextDecoder('utf8')\n  return 'u' + decoder.decode(buf)\n}, (str) => {\n  const encoder = new TextEncoder()\n  return encoder.encode(str.substring(1))\n})\n\nconst ascii = createCodec('ascii', 'a', (buf) => {\n  let string = 'a'\n\n  for (let i = 0; i < buf.length; i++) {\n    string += String.fromCharCode(buf[i])\n  }\n  return string\n}, (str) => {\n  str = str.substring(1)\n  const buf = allocUnsafe(str.length)\n\n  for (let i = 0; i < str.length; i++) {\n    buf[i] = str.charCodeAt(i)\n  }\n\n  return buf\n})\n\nexport type SupportedEncodings = 'utf8' | 'utf-8' | 'hex' | 'latin1' | 'ascii' | 'binary' | keyof typeof bases\n\nconst BASES: Record<SupportedEncodings, MultibaseCodec<any>> = {\n  utf8: string,\n  'utf-8': string,\n  hex: bases.base16,\n  latin1: ascii,\n  ascii,\n  binary: ascii,\n\n  ...bases\n}\n\nexport default BASES\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,KAAK,EAAE,MAAM,qBAAqB,CAAA;AAE3C,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAA;;;AAEpC,SAAS,WAAW,CAAE,IAAY,EAAE,MAAc,EAAE,MAAmC,EAAE,MAAmC;IAC1H,OAAO;QACL,IAAI;QACJ,MAAM;QACN,OAAO,EAAE;YACP,IAAI;YACJ,MAAM;YACN,MAAM;SACP;QACD,OAAO,EAAE;YACP,MAAM;SACP;KACF,CAAA;AACH,CAAC;AAED,MAAM,MAAM,GAAG,WAAW,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE;IAC9C,MAAM,OAAO,GAAG,IAAI,WAAW,CAAC,MAAM,CAAC,CAAA;IACvC,OAAO,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;AAClC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;IACT,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE,CAAA;IACjC,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAA;AACzC,CAAC,CAAC,CAAA;AAEF,MAAM,KAAK,GAAG,WAAW,CAAC,OAAO,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE;IAC9C,IAAI,MAAM,GAAG,GAAG,CAAA;IAEhB,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;QACpC,MAAM,IAAI,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IACvC,CAAC;IACD,OAAO,MAAM,CAAA;AACf,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE;IACT,GAAG,GAAG,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAA;IACtB,MAAM,GAAG,OAAG,oNAAW,EAAC,GAAG,CAAC,MAAM,CAAC,CAAA;IAEnC,IAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,CAAE,CAAC;QACpC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAA;IAC5B,CAAC;IAED,OAAO,GAAG,CAAA;AACZ,CAAC,CAAC,CAAA;AAIF,MAAM,KAAK,GAAoD;IAC7D,IAAI,EAAE,MAAM;IACZ,OAAO,EAAE,MAAM;IACf,GAAG,EAAE,iLAAK,CAAC,MAAM;IACjB,MAAM,EAAE,KAAK;IACb,KAAK;IACL,MAAM,EAAE,KAAK;IAEb,GAAG,iLAAK;CACT,CAAA;uCAEc,KAAK,CAAA"}},
    {"offset": {"line": 598, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/from-string.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/from-string.ts"],"sourcesContent":["import bases, { type SupportedEncodings } from './util/bases.js'\n\nexport type { SupportedEncodings }\n\n/**\n * Create a `Uint8Array` from the passed string\n *\n * Supports `utf8`, `utf-8`, `hex`, and any encoding supported by the multiformats module.\n *\n * Also `ascii` which is similar to node's 'binary' encoding.\n */\nexport function fromString (string: string, encoding: SupportedEncodings = 'utf8'): Uint8Array {\n  const base = bases[encoding]\n\n  if (base == null) {\n    throw new Error(`Unsupported encoding \"${encoding}\"`)\n  }\n\n  // add multibase prefix\n  return base.decoder.decode(`${base.prefix}${string}`) // eslint-disable-line @typescript-eslint/restrict-template-expressions\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,KAAK,EAAE,EAA2B,MAAM,iBAAiB,CAAA;;AAW1D,SAAU,UAAU,CAAE,MAAc,EAAE,WAA+B,MAAM;IAC/E,MAAM,IAAI,GAAG,wNAAK,CAAC,QAAQ,CAAC,CAAA;IAE5B,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC;QACjB,MAAM,IAAI,KAAK,CAAC,CAAA,sBAAA,EAAyB,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAA;IACvD,CAAC;IAED,uBAAuB;IACvB,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,CAAA,CAAC,uEAAuE;AAC/H,CAAC"}},
    {"offset": {"line": 616, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/to-string.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/to-string.ts"],"sourcesContent":["import bases, { type SupportedEncodings } from './util/bases.js'\n\nexport type { SupportedEncodings }\n\n/**\n * Turns a `Uint8Array` into a string.\n *\n * Supports `utf8`, `utf-8` and any encoding supported by the multibase module.\n *\n * Also `ascii` which is similar to node's 'binary' encoding.\n */\nexport function toString (array: Uint8Array, encoding: SupportedEncodings = 'utf8'): string {\n  const base = bases[encoding]\n\n  if (base == null) {\n    throw new Error(`Unsupported encoding \"${encoding}\"`)\n  }\n\n  // strip multibase prefix\n  return base.encoder.encode(array).substring(1)\n}\n"],"names":[],"mappings":";;;;AAAA,OAAO,KAAK,EAAE,EAA2B,MAAM,iBAAiB,CAAA;;AAW1D,SAAU,QAAQ,CAAE,KAAiB,EAAE,WAA+B,MAAM;IAChF,MAAM,IAAI,GAAG,wNAAK,CAAC,QAAQ,CAAC,CAAA;IAE5B,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC;QACjB,MAAM,IAAI,KAAK,CAAC,CAAA,sBAAA,EAAyB,QAAQ,CAAA,CAAA,CAAG,CAAC,CAAA;IACvD,CAAC;IAED,yBAAyB;IACzB,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAA;AAChD,CAAC"}},
    {"offset": {"line": 634, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@storacha/blob-index/node_modules/uint8arrays/dist/src/index.js","sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/node_modules/uint8arrays/src/index.ts"],"sourcesContent":["/**\n * @packageDocumentation\n *\n * `Uint8Array`s bring memory-efficient(ish) byte handling to browsers - they are similar to Node.js `Buffer`s but lack a lot of the utility methods present on that class.\n *\n * This module exports a number of function that let you do common operations - joining Uint8Arrays together, seeing if they have the same contents etc.\n *\n * Since Node.js `Buffer`s are also `Uint8Array`s, it falls back to `Buffer` internally where it makes sense for performance reasons.\n *\n * ## alloc(size)\n *\n * Create a new `Uint8Array`. When running under Node.js, `Buffer` will be used in preference to `Uint8Array`.\n *\n * ### Example\n *\n * ```js\n * import { alloc } from 'uint8arrays/alloc'\n *\n * const buf = alloc(100)\n * ```\n *\n * ## allocUnsafe(size)\n *\n * Create a new `Uint8Array`. When running under Node.js, `Buffer` will be used in preference to `Uint8Array`.\n *\n * On platforms that support it, memory referenced by the returned `Uint8Array` will not be initialized.\n *\n * ### Example\n *\n * ```js\n * import { allocUnsafe } from 'uint8arrays/alloc'\n *\n * const buf = allocUnsafe(100)\n * ```\n *\n * ## compare(a, b)\n *\n * Compare two `Uint8Arrays`\n *\n * ### Example\n *\n * ```js\n * import { compare } from 'uint8arrays/compare'\n *\n * const arrays = [\n *   Uint8Array.from([3, 4, 5]),\n *   Uint8Array.from([0, 1, 2])\n * ]\n *\n * const sorted = arrays.sort(compare)\n *\n * console.info(sorted)\n * // [\n * //    Uint8Array[0, 1, 2]\n * //    Uint8Array[3, 4, 5]\n * // ]\n * ```\n *\n * ## concat(arrays, \\[length])\n *\n * Concatenate one or more `Uint8Array`s and return a `Uint8Array` with their contents.\n *\n * If you know the length of the arrays, pass it as a second parameter, otherwise it will be calculated by traversing the list of arrays.\n *\n * ### Example\n *\n * ```js\n * import { concat } from 'uint8arrays/concat'\n *\n * const arrays = [\n *   Uint8Array.from([0, 1, 2]),\n *   Uint8Array.from([3, 4, 5])\n * ]\n *\n * const all = concat(arrays, 6)\n *\n * console.info(all)\n * // Uint8Array[0, 1, 2, 3, 4, 5]\n * ```\n *\n * ## equals(a, b)\n *\n * Returns true if the two arrays are the same array or if they have the same length and contents.\n *\n * ### Example\n *\n * ```js\n * import { equals } from 'uint8arrays/equals'\n *\n * const a = Uint8Array.from([0, 1, 2])\n * const b = Uint8Array.from([3, 4, 5])\n * const c = Uint8Array.from([0, 1, 2])\n *\n * console.info(equals(a, b)) // false\n * console.info(equals(a, c)) // true\n * console.info(equals(a, a)) // true\n * ```\n *\n * ## fromString(string, encoding = 'utf8')\n *\n * Returns a new `Uint8Array` created from the passed string and interpreted as the passed encoding.\n *\n * Supports `utf8` and any of the [multibase encodings](https://github.com/multiformats/multibase/blob/master/multibase.csv) as implemented by the [multiformats module](https://www.npmjs.com/package/multiformats).\n *\n * ### Example\n *\n * ```js\n * import { fromString } from 'uint8arrays/from-string'\n *\n * console.info(fromString('hello world')) // Uint8Array[104, 101 ...\n * console.info(fromString('00010203aabbcc', 'base16')) // Uint8Array[0, 1 ...\n * console.info(fromString('AAECA6q7zA', 'base64')) // Uint8Array[0, 1 ...\n * console.info(fromString('01234', 'ascii')) // Uint8Array[48, 49 ...\n * ```\n *\n * ## toString(array, encoding = 'utf8')\n *\n * Returns a string created from the passed `Uint8Array` in the passed encoding.\n *\n * Supports `utf8` and any of the [multibase encodings](https://github.com/multiformats/multibase/blob/master/multibase.csv) as implemented by the [multiformats module](https://www.npmjs.com/package/multiformats).\n *\n * ### Example\n *\n * ```js\n * import { toString } from 'uint8arrays/to-string'\n *\n * console.info(toString(Uint8Array.from([104, 101...]))) // 'hello world'\n * console.info(toString(Uint8Array.from([0, 1, 2...]), 'base16')) // '00010203aabbcc'\n * console.info(toString(Uint8Array.from([0, 1, 2...]), 'base64')) // 'AAECA6q7zA'\n * console.info(toString(Uint8Array.from([48, 49, 50...]), 'ascii')) // '01234'\n * ```\n *\n * ## xor(a, b)\n *\n * Returns a `Uint8Array` containing `a` and `b` xored together.\n *\n * ### Example\n *\n * ```js\n * import { xor } from 'uint8arrays/xor'\n *\n * console.info(xor(Uint8Array.from([1, 0]), Uint8Array.from([0, 1]))) // Uint8Array[1, 1]\n * ```\n *\n * ## xorCompare(a, b)\n *\n * Compares the distances between two xor `Uint8Array`s.\n *\n * ### Example\n *\n * ```ts\n * import { xor } from 'uint8arrays/xor'\n * import { xorCompare } from 'uint8arrays/xor-compare'\n *\n * const target = Uint8Array.from([1, 1])\n * const val1 = Uint8Array.from([1, 0])\n * const xor1 = xor(target, val1)\n *\n * const val2 = Uint8Array.from([0, 1])\n * const xor2 = xor(target, val2)\n *\n * console.info(xorCompare(xor1, xor2)) // -1 or 0 or 1\n * ```\n */\n\nimport { equals } from './equals.js'\nimport { xor } from './xor.js'\nimport { compare } from '#compare'\nimport { concat } from '#concat'\nimport { fromString } from '#from-string'\nimport { toString } from '#to-string'\n\nexport {\n  compare,\n  concat,\n  equals,\n  fromString,\n  toString,\n  xor\n}\n\nexport type { SupportedEncodings } from './util/bases.js'\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAmKG;AAEH,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAA;AACpC,OAAO,EAAE,GAAG,EAAE,MAAM,UAAU,CAAA;AAC9B,OAAO,EAAE,OAAO,EAAE,MAAM,UAAU,CAAA;AAClC,OAAO,EAAE,MAAM,EAAE,MAAM,SAAS,CAAA;AAChC,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAA;AACzC,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAA"}},
    {"offset": {"line": 816, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/errors.js"],"sourcesContent":["export {};\n//# sourceMappingURL=errors.js.map"],"names":[],"mappings":";;CACA,kCAAkC","ignoreList":[0]}},
    {"offset": {"line": 823, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/types.js"],"sourcesContent":["// export other types\nexport * from '@ucanto/interface';\nexport * from '@storacha/capabilities/types';\nexport * from './errors.js';\nexport * from '@storacha/did-mailto';\nexport var AppName;\n(function (AppName) {\n    AppName[\"BskyBackups\"] = \"bsky-backups\";\n    AppName[\"TGMiniapp\"] = \"tg-miniapp\";\n    AppName[\"Console\"] = \"console\";\n})(AppName || (AppName = {}));\n//# sourceMappingURL=types.js.map"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;AACA;AACA;AACA;;;;;AACO,IAAI;AACX,CAAC,SAAU,OAAO;IACd,OAAO,CAAC,cAAc,GAAG;IACzB,OAAO,CAAC,YAAY,GAAG;IACvB,OAAO,CAAC,UAAU,GAAG;AACzB,CAAC,EAAE,WAAW,CAAC,UAAU,CAAC,CAAC,IAC3B,iCAAiC","ignoreList":[0]}},
    {"offset": {"line": 846, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/encoding.js"],"sourcesContent":["/**\n * Encoding utilities\n *\n * It is recommended that you import directly with:\n * ```js\n * import * as Encoding from '@storacha/access/encoding'\n *\n * // or\n *\n * import { encodeDelegations } from '@storacha/access/encoding'\n * ```\n *\n * @module\n */\nimport { CarBufferReader } from '@ipld/car/buffer-reader';\nimport * as CarBufferWriter from '@ipld/car/buffer-writer';\nimport { Delegation } from '@ucanto/core/delegation';\nimport * as u8 from 'uint8arrays';\n// eslint-disable-next-line no-unused-vars\nimport * as Types from '@ucanto/interface';\n/**\n * Encode delegations as bytes\n *\n * @param {Types.Delegation[]} delegations\n */\nexport function delegationsToBytes(delegations) {\n    if (!Array.isArray(delegations) || delegations.length === 0) {\n        throw new Error('Delegations required to be an non empty array.');\n    }\n    const roots = delegations.map((d) => /** @type {CarBufferWriter.CID} */ (d.root.cid));\n    const cids = new Set();\n    /** @type {CarBufferWriter.Block[]} */\n    const blocks = [];\n    let byteLength = 0;\n    for (const delegation of delegations) {\n        for (const block of delegation.export()) {\n            const cid = block.cid.toV1().toString();\n            if (!cids.has(cid)) {\n                byteLength += CarBufferWriter.blockLength(\n                /** @type {CarBufferWriter.Block} */ (block));\n                blocks.push(/** @type {CarBufferWriter.Block} */ (block));\n                cids.add(cid);\n            }\n        }\n    }\n    const headerLength = CarBufferWriter.estimateHeaderLength(roots.length);\n    const writer = CarBufferWriter.createWriter(new ArrayBuffer(headerLength + byteLength), { roots });\n    for (const block of blocks) {\n        writer.write(block);\n    }\n    return writer.close();\n}\n/**\n * Decode bytes into Delegations\n *\n * @template {Types.Capabilities} [T=Types.Capabilities]\n * @param {import('./types.js').BytesDelegation<T>} bytes\n */\nexport function bytesToDelegations(bytes) {\n    if (!(bytes instanceof Uint8Array) || bytes.length === 0) {\n        throw new TypeError('Input should be a non-empty Uint8Array.');\n    }\n    const reader = CarBufferReader.fromBytes(bytes);\n    const roots = reader.getRoots();\n    /** @type {Types.Delegation<T>[]} */\n    const delegations = [];\n    for (const root of roots) {\n        const rootBlock = reader.get(root);\n        if (rootBlock) {\n            const blocks = new Map();\n            for (const block of reader.blocks()) {\n                if (block.cid.toString() !== root.toString())\n                    blocks.set(block.cid.toString(), block);\n            }\n            // @ts-ignore\n            delegations.push(new Delegation(rootBlock, blocks));\n        }\n        else {\n            throw new Error('Failed to find root from raw delegation.');\n        }\n    }\n    return delegations;\n}\n/**\n * @param {Types.Delegation[]} delegations\n * @param {import('uint8arrays/to-string').SupportedEncodings} encoding\n */\nexport function delegationsToString(delegations, encoding = 'base64url') {\n    const bytes = delegationsToBytes(delegations);\n    return u8.toString(bytes, encoding);\n}\n/**\n * Encode one {@link Types.Delegation Delegation} into a string\n *\n * @param {Types.Delegation<Types.Capabilities>} delegation\n * @param {import('uint8arrays/to-string').SupportedEncodings} [encoding]\n */\nexport function delegationToString(delegation, encoding) {\n    return delegationsToString([delegation], encoding);\n}\n/**\n * Decode string into {@link Types.Delegation Delegation}\n *\n * @template {Types.Capabilities} [T=Types.Capabilities]\n * @param {import('./types.js').EncodedDelegation<T>} raw\n * @param {import('uint8arrays/to-string').SupportedEncodings} [encoding]\n */\nexport function stringToDelegations(raw, encoding = 'base64url') {\n    const bytes = u8.fromString(raw, encoding);\n    return bytesToDelegations(bytes);\n}\n/**\n * Decode string into a {@link Types.Delegation Delegation}\n *\n * @template {Types.Capabilities} [T=Types.Capabilities]\n * @param {import('./types.js').EncodedDelegation<T>} raw\n * @param {import('uint8arrays/to-string').SupportedEncodings} [encoding]\n */\nexport function stringToDelegation(raw, encoding) {\n    const delegations = stringToDelegations(raw, encoding);\n    return /** @type {Types.Delegation<T>} */ (delegations[0]);\n}\n/**\n * @param {number} [expiration]\n */\nexport function expirationToDate(expiration) {\n    const expires = expiration === Infinity || !expiration\n        ? undefined\n        : new Date(expiration * 1000);\n    return expires;\n}\n//# sourceMappingURL=encoding.js.map"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;CAaC;;;;;;;;;;;;;;;;AACD;AACA;AACA;AACA;AAAA;AAAA;AACA,0CAA0C;AAC1C;;;;;;AAMO,SAAS,mBAAmB,WAAW;IAC1C,IAAI,CAAC,MAAM,OAAO,CAAC,gBAAgB,YAAY,MAAM,KAAK,GAAG;QACzD,MAAM,IAAI,MAAM;IACpB;IACA,MAAM,QAAQ,YAAY,GAAG,CAAC,CAAC,IAA0C,EAAE,IAAI,CAAC,GAAG;IACnF,MAAM,OAAO,IAAI;IACjB,oCAAoC,GACpC,MAAM,SAAS,EAAE;IACjB,IAAI,aAAa;IACjB,KAAK,MAAM,cAAc,YAAa;QAClC,KAAK,MAAM,SAAS,WAAW,MAAM,GAAI;YACrC,MAAM,MAAM,MAAM,GAAG,CAAC,IAAI,GAAG,QAAQ;YACrC,IAAI,CAAC,KAAK,GAAG,CAAC,MAAM;gBAChB,cAAc,0KAA2B,CACH;gBACtC,OAAO,IAAI,CAAuC;gBAClD,KAAK,GAAG,CAAC;YACb;QACJ;IACJ;IACA,MAAM,eAAe,mLAAoC,CAAC,MAAM,MAAM;IACtE,MAAM,SAAS,2KAA4B,CAAC,IAAI,YAAY,eAAe,aAAa;QAAE;IAAM;IAChG,KAAK,MAAM,SAAS,OAAQ;QACxB,OAAO,KAAK,CAAC;IACjB;IACA,OAAO,OAAO,KAAK;AACvB;AAOO,SAAS,mBAAmB,KAAK;IACpC,IAAI,CAAC,CAAC,iBAAiB,UAAU,KAAK,MAAM,MAAM,KAAK,GAAG;QACtD,MAAM,IAAI,UAAU;IACxB;IACA,MAAM,SAAS,yLAAe,CAAC,SAAS,CAAC;IACzC,MAAM,QAAQ,OAAO,QAAQ;IAC7B,kCAAkC,GAClC,MAAM,cAAc,EAAE;IACtB,KAAK,MAAM,QAAQ,MAAO;QACtB,MAAM,YAAY,OAAO,GAAG,CAAC;QAC7B,IAAI,WAAW;YACX,MAAM,SAAS,IAAI;YACnB,KAAK,MAAM,SAAS,OAAO,MAAM,GAAI;gBACjC,IAAI,MAAM,GAAG,CAAC,QAAQ,OAAO,KAAK,QAAQ,IACtC,OAAO,GAAG,CAAC,MAAM,GAAG,CAAC,QAAQ,IAAI;YACzC;YACA,aAAa;YACb,YAAY,IAAI,CAAC,IAAI,sKAAU,CAAC,WAAW;QAC/C,OACK;YACD,MAAM,IAAI,MAAM;QACpB;IACJ;IACA,OAAO;AACX;AAKO,SAAS,oBAAoB,WAAW,EAAE,WAAW,WAAW;IACnE,MAAM,QAAQ,mBAAmB;IACjC,OAAO,iNAAW,CAAC,OAAO;AAC9B;AAOO,SAAS,mBAAmB,UAAU,EAAE,QAAQ;IACnD,OAAO,oBAAoB;QAAC;KAAW,EAAE;AAC7C;AAQO,SAAS,oBAAoB,GAAG,EAAE,WAAW,WAAW;IAC3D,MAAM,QAAQ,qNAAa,CAAC,KAAK;IACjC,OAAO,mBAAmB;AAC9B;AAQO,SAAS,mBAAmB,GAAG,EAAE,QAAQ;IAC5C,MAAM,cAAc,oBAAoB,KAAK;IAC7C,OAA2C,WAAW,CAAC,EAAE;AAC7D;AAIO,SAAS,iBAAiB,UAAU;IACvC,MAAM,UAAU,eAAe,YAAY,CAAC,aACtC,YACA,IAAI,KAAK,aAAa;IAC5B,OAAO;AACX,EACA,oCAAoC","ignoreList":[0]}},
    {"offset": {"line": 962, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/access.js"],"sourcesContent":["import * as Access from '@storacha/capabilities/access';\nimport * as API from './types.js';\nimport { Failure, fail, DID } from '@ucanto/core';\nimport { Agent, importAuthorization } from './agent.js';\nimport { bytesToDelegations } from './encoding.js';\n/**\n * Takes array of delegations and propagates them to their respective audiences\n * through a given space (or the current space if none is provided).\n *\n * Returns error result if agent has no current space and no space was provided.\n * Also returns error result if invocation fails.\n *\n * @param {Agent} agent - Agent connected to the w3up service.\n * @param {object} input\n * @param {API.Delegation[]} input.delegations - Delegations to propagate.\n * @param {API.SpaceDID} [input.space] - Space to propagate through.\n * @param {API.Delegation[]} [input.proofs] - Optional set of proofs to be\n * included in the invocation.\n */\nexport const delegate = async (agent, { delegations, proofs = [], space = agent.currentSpace() }) => {\n    if (!space) {\n        return fail('Space must be specified');\n    }\n    const entries = Object.values(delegations).map((proof) => [\n        proof.cid.toString(),\n        proof.cid,\n    ]);\n    const { out } = await agent.invokeAndExecute(Access.delegate, {\n        with: space,\n        nb: {\n            delegations: Object.fromEntries(entries),\n        },\n        // must be embedded here because it's referenced by cid in .nb.delegations\n        proofs: [...delegations, ...proofs],\n    });\n    return out;\n};\n/**\n * Requests specified `access` level from specified `account`. It invokes\n * `access/authorize` capability, if invocation succeeds it will return a\n * `PendingAccessRequest` object that can be used to poll for the requested\n * delegation through `access/claim` capability.\n *\n * @param {API.Agent} agent\n * @param {object} input\n * @param {API.AccountDID} input.account - Account from which access is requested.\n * @param {API.ProviderDID} [input.provider] - Provider that will receive the invocation.\n * @param {API.DID} [input.audience] - Principal requesting an access.\n * @param {API.Access} [input.access] - Access been requested.\n * @param {API.AppName} [input.appName] - App name for the access request\n * @param {API.SSORequestParams} [input.sso] - SSO authentication request (all fields required if provided)\n * @returns {Promise<API.Result<PendingAccessRequest, API.AccessAuthorizeFailure|API.InvocationError>>}\n */\nexport const request = async (agent, { account, provider = /** @type {API.ProviderDID} */ (agent.connection.id.did()), audience: audience = agent.did(), access = spaceAccess, appName, sso, }) => {\n    // Build facts array with appName and SSO object\n    const facts = [];\n    if (appName) {\n        facts.push({ appName });\n    }\n    if (sso) {\n        if (typeof sso !== 'object') {\n            return fail('SSO parameter must be an object');\n        }\n        if (!sso.authProvider || typeof sso.authProvider !== 'string') {\n            return fail('SSO authProvider must be a non-empty string');\n        }\n        if (!sso.externalUserId || typeof sso.externalUserId !== 'string') {\n            return fail('SSO externalUserId must be a non-empty string');\n        }\n        if (!sso.externalSessionToken ||\n            typeof sso.externalSessionToken !== 'string') {\n            return fail('SSO externalSessionToken must be a non-empty string');\n        }\n        facts.push({\n            sso: {\n                authProvider: sso.authProvider,\n                externalUserId: sso.externalUserId,\n                externalSessionToken: sso.externalSessionToken,\n            },\n        });\n    }\n    // Request access from the account.\n    const { out: result } = await agent.invokeAndExecute(Access.authorize, {\n        audience: DID.parse(provider),\n        with: audience,\n        nb: {\n            iss: account,\n            // New ucan spec moved to recap style layout for capabilities and new\n            // `access/request` will use similar format as opposed to legacy one,\n            // in the meantime we translate new format to legacy format here.\n            att: [...toCapabilities(access)],\n        },\n        facts,\n    });\n    return result.error\n        ? result\n        : {\n            ok: new PendingAccessRequest({\n                ...result.ok,\n                agent,\n                audience,\n                provider,\n            }),\n        };\n};\n/**\n * Claims access that has been delegated to the given audience, which by\n * default is the agent's DID.\n *\n * @param {API.Agent} agent\n * @param {object} input\n * @param {API.DID} [input.audience] - Principal requesting an access.\n * @param {API.ProviderDID} [input.provider] - Provider handling the invocation.\n * @returns {Promise<API.Result<GrantedAccess, API.AccessClaimFailure|API.InvocationError>>}\n */\nexport const claim = async (agent, { provider = /** @type {API.ProviderDID} */ (agent.connection.id.did()), audience = agent.did(), } = {}) => {\n    const { out: result } = await agent.invokeAndExecute(Access.claim, {\n        audience: DID.parse(provider),\n        with: audience,\n    });\n    if (result.error) {\n        return result;\n    }\n    else {\n        const delegations = Object.values(result.ok.delegations);\n        const proofs = /** @type {API.Tuple<API.Delegation>} */ (delegations.flatMap((proof) => bytesToDelegations(proof)));\n        return { ok: new GrantedAccess({ agent, proofs }) };\n    }\n};\n/**\n * Creates a new `PendingAccessRequest` object that can be used to poll for the\n * requested delegation through `access/claim` capability.\n *\n * @param {API.Agent} agent\n * @param {object} input\n * @param {API.Link} input.request - Link to the `access/authorize` invocation.\n * @param {API.UTCUnixTimestamp} input.expiration - Seconds in UTC.\n * @param {API.DID} [input.audience] - Principal requesting an access.\n * @param {API.ProviderDID} [input.provider] - Provider handling request.\n */\nexport const createPendingAccessRequest = (agent, { request, expiration, provider = /** @type {API.ProviderDID} */ (agent.connection.id.did()), audience: audience = agent.did(), }) => new PendingAccessRequest({ agent, request, expiration, provider, audience });\n/**\n * Represents a pending access request. It can be used to poll for the requested\n * delegation.\n */\nclass PendingAccessRequest {\n    /**\n     * @typedef {object} PendingAccessRequestModel\n     * @property {API.Agent} agent - Agent handling interaction.\n     * @property {API.DID} audience - Principal requesting an access.\n     * @property {API.ProviderDID} provider - Provider handling request.\n     * @property {API.UTCUnixTimestamp} expiration - Seconds in UTC.\n     * @property {API.Link} request - Link to the `access/authorize` invocation.\n     *\n     * @param {PendingAccessRequestModel} model\n     */\n    constructor(model) {\n        this.model = model;\n    }\n    get agent() {\n        return this.model.agent;\n    }\n    get audience() {\n        return this.model.audience;\n    }\n    get expiration() {\n        return new Date(this.model.expiration * 1000);\n    }\n    get request() {\n        return this.model.request;\n    }\n    get provider() {\n        return this.model.provider;\n    }\n    /**\n     * Low level method and most likely you want to use `.claim` instead. This method will poll\n     * fetch delegations **just once** and will return proofs matching to this request. Please note\n     * that there may not be any matches in which case result will be `{ ok: [] }`.\n     *\n     * If you do want to continuously poll until request is approved or expired, you should use\n     * `.claim` method instead.\n     *\n     * @returns {Promise<API.Result<API.Delegation[], API.InvocationError|API.AccessClaimFailure|RequestExpired>>}\n     */\n    async poll() {\n        const { agent, audience, provider, expiration } = this.model;\n        const timeout = expiration * 1000 - Date.now();\n        if (timeout <= 0) {\n            return { error: new RequestExpired(this.model) };\n        }\n        else {\n            const result = await claim(agent, { audience, provider });\n            return result.error\n                ? result\n                : {\n                    ok: result.ok.proofs.filter((proof) => isRequestedAccess(proof, this.model)),\n                };\n        }\n    }\n    /**\n     * Continuously polls delegations until this request is approved or expired. Returns\n     * a `GrantedAccess` object (view over the delegations) that can be used in the\n     * invocations or can be saved in the agent (store) using `.save()` method.\n     *\n     * @param {object} options\n     * @param {number} [options.interval]\n     * @param {AbortSignal} [options.signal]\n     * @returns {Promise<API.Result<GrantedAccess, Error>>}\n     */\n    async claim({ signal, interval = 250 } = {}) {\n        while (signal?.aborted !== true) {\n            const result = await this.poll();\n            // If polling failed, return the error.\n            if (result.error) {\n                return result;\n            }\n            // If we got some matching proofs, return them.\n            else if (result.ok.length > 0) {\n                return {\n                    ok: new GrantedAccess({\n                        agent: this.agent,\n                        proofs: /** @type {API.Tuple<API.Delegation>} */ (result.ok),\n                    }),\n                };\n            }\n            await new Promise((resolve) => setTimeout(resolve, interval));\n        }\n        return {\n            error: Object.assign(new Error('Aborted'), { reason: signal.reason }),\n        };\n    }\n}\n/**\n * Error returned when pending access request expires.\n */\nclass RequestExpired extends Failure {\n    /**\n     * @param {PendingAccessRequestModel} model\n     */\n    constructor(model) {\n        super();\n        this.model = model;\n    }\n    get name() {\n        return 'RequestExpired';\n    }\n    get request() {\n        return this.model.request;\n    }\n    get expiredAt() {\n        return new Date(this.model.expiration * 1000);\n    }\n    describe() {\n        return `Access request expired at ${this.expiredAt} for ${this.request} request.`;\n    }\n}\n/**\n * View over the UCAN Delegations that grant access to a specific principal.\n */\nexport class GrantedAccess {\n    /**\n     * @typedef {object} GrantedAccessModel\n     * @property {API.Agent} agent - Agent that processed the request.\n     * @property {API.Tuple<API.Delegation>} proofs - Delegations that grant access.\n     *\n     * @param {GrantedAccessModel} model\n     */\n    constructor(model) {\n        this.model = model;\n    }\n    get proofs() {\n        return this.model.proofs;\n    }\n    /**\n     * Saves access into the agents proofs store so that it can be retained\n     * between sessions.\n     *\n     * @param {object} input\n     * @param {API.Agent} [input.agent]\n     */\n    save({ agent = this.model.agent } = {}) {\n        return importAuthorization(agent, this);\n    }\n}\n/**\n * Checks if the given delegation is caused by the passed `request` for access.\n *\n * @param {API.Delegation} delegation\n * @param {object} selector\n * @param {API.Link} selector.request\n * @returns\n */\nconst isRequestedAccess = (delegation, { request }) => \n// `access/confirm` handler adds facts to the delegation issued by the account\n// so that principal requesting access can identify correct delegation when\n// access is granted.\ndelegation.facts.some((fact) => `${fact['access/request']}` === `${request}`);\n/**\n * Maps access object that uses UCAN 0.10 capabilities format as opposed\n * to legacy UCAN 0.9 format used by w3up  which predates new format.\n *\n * @param {API.Access} access\n * @returns {{ can: API.Ability }[]}\n */\nexport const toCapabilities = (access) => {\n    const abilities = [];\n    const entries = /** @type {[API.Ability, API.Unit][]} */ (Object.entries(access));\n    for (const [can, details] of entries) {\n        if (details) {\n            abilities.push({ can });\n        }\n    }\n    return abilities;\n};\n/**\n * Set of capabilities required by the agent to manage a space.\n */\nexport const spaceAccess = {\n    'assert/*': {},\n    'space/*': {},\n    'blob/*': {},\n    'index/*': {},\n    'store/*': {},\n    'upload/*': {},\n    'access/*': {},\n    'filecoin/*': {},\n    'usage/*': {},\n};\n/**\n * Set of capabilities required for by the agent to manage an account.\n */\nexport const accountAccess = {\n    '*': {},\n};\n//# sourceMappingURL=access.js.map"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;;;;;;AAeO,MAAM,WAAW,OAAO,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,EAAE,QAAQ,MAAM,YAAY,EAAE,EAAE;IAC5F,IAAI,CAAC,OAAO;QACR,OAAO,IAAA,4JAAI,EAAC;IAChB;IACA,MAAM,UAAU,OAAO,MAAM,CAAC,aAAa,GAAG,CAAC,CAAC,QAAU;YACtD,MAAM,GAAG,CAAC,QAAQ;YAClB,MAAM,GAAG;SACZ;IACD,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,MAAM,gBAAgB,CAAC,2LAAe,EAAE;QAC1D,MAAM;QACN,IAAI;YACA,aAAa,OAAO,WAAW,CAAC;QACpC;QACA,0EAA0E;QAC1E,QAAQ;eAAI;eAAgB;SAAO;IACvC;IACA,OAAO;AACX;AAiBO,MAAM,UAAU,OAAO,OAAO,EAAE,OAAO,EAAE,WAA2C,MAAM,UAAU,CAAC,EAAE,CAAC,GAAG,EAAG,EAAE,UAAU,WAAW,MAAM,GAAG,EAAE,EAAE,SAAS,WAAW,EAAE,OAAO,EAAE,GAAG,EAAG;IAC1L,gDAAgD;IAChD,MAAM,QAAQ,EAAE;IAChB,IAAI,SAAS;QACT,MAAM,IAAI,CAAC;YAAE;QAAQ;IACzB;IACA,IAAI,KAAK;QACL,IAAI,OAAO,QAAQ,UAAU;YACzB,OAAO,IAAA,4JAAI,EAAC;QAChB;QACA,IAAI,CAAC,IAAI,YAAY,IAAI,OAAO,IAAI,YAAY,KAAK,UAAU;YAC3D,OAAO,IAAA,4JAAI,EAAC;QAChB;QACA,IAAI,CAAC,IAAI,cAAc,IAAI,OAAO,IAAI,cAAc,KAAK,UAAU;YAC/D,OAAO,IAAA,4JAAI,EAAC;QAChB;QACA,IAAI,CAAC,IAAI,oBAAoB,IACzB,OAAO,IAAI,oBAAoB,KAAK,UAAU;YAC9C,OAAO,IAAA,4JAAI,EAAC;QAChB;QACA,MAAM,IAAI,CAAC;YACP,KAAK;gBACD,cAAc,IAAI,YAAY;gBAC9B,gBAAgB,IAAI,cAAc;gBAClC,sBAAsB,IAAI,oBAAoB;YAClD;QACJ;IACJ;IACA,mCAAmC;IACnC,MAAM,EAAE,KAAK,MAAM,EAAE,GAAG,MAAM,MAAM,gBAAgB,CAAC,4LAAgB,EAAE;QACnE,UAAU,4LAAG,CAAC,KAAK,CAAC;QACpB,MAAM;QACN,IAAI;YACA,KAAK;YACL,qEAAqE;YACrE,qEAAqE;YACrE,iEAAiE;YACjE,KAAK;mBAAI,eAAe;aAAQ;QACpC;QACA;IACJ;IACA,OAAO,OAAO,KAAK,GACb,SACA;QACE,IAAI,IAAI,qBAAqB;YACzB,GAAG,OAAO,EAAE;YACZ;YACA;YACA;QACJ;IACJ;AACR;AAWO,MAAM,QAAQ,OAAO,OAAO,EAAE,WAA2C,MAAM,UAAU,CAAC,EAAE,CAAC,GAAG,EAAG,EAAE,WAAW,MAAM,GAAG,EAAE,EAAG,GAAG,CAAC,CAAC;IACtI,MAAM,EAAE,KAAK,MAAM,EAAE,GAAG,MAAM,MAAM,gBAAgB,CAAC,wLAAY,EAAE;QAC/D,UAAU,4LAAG,CAAC,KAAK,CAAC;QACpB,MAAM;IACV;IACA,IAAI,OAAO,KAAK,EAAE;QACd,OAAO;IACX,OACK;QACD,MAAM,cAAc,OAAO,MAAM,CAAC,OAAO,EAAE,CAAC,WAAW;QACvD,MAAM,SAAmD,YAAY,OAAO,CAAC,CAAC,QAAU,IAAA,iLAAkB,EAAC;QAC3G,OAAO;YAAE,IAAI,IAAI,cAAc;gBAAE;gBAAO;YAAO;QAAG;IACtD;AACJ;AAYO,MAAM,6BAA6B,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,WAA2C,MAAM,UAAU,CAAC,EAAE,CAAC,GAAG,EAAG,EAAE,UAAU,WAAW,MAAM,GAAG,EAAE,EAAG,GAAK,IAAI,qBAAqB;QAAE;QAAO;QAAS;QAAY;QAAU;IAAS;AAClQ;;;CAGC,GACD,MAAM;IACF;;;;;;;;;KASC,GACD,YAAY,KAAK,CAAE;QACf,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,IAAI,QAAQ;QACR,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK;IAC3B;IACA,IAAI,WAAW;QACX,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ;IAC9B;IACA,IAAI,aAAa;QACb,OAAO,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG;IAC5C;IACA,IAAI,UAAU;QACV,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO;IAC7B;IACA,IAAI,WAAW;QACX,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ;IAC9B;IACA;;;;;;;;;KASC,GACD,MAAM,OAAO;QACT,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC,KAAK;QAC5D,MAAM,UAAU,aAAa,OAAO,KAAK,GAAG;QAC5C,IAAI,WAAW,GAAG;YACd,OAAO;gBAAE,OAAO,IAAI,eAAe,IAAI,CAAC,KAAK;YAAE;QACnD,OACK;YACD,MAAM,SAAS,MAAM,MAAM,OAAO;gBAAE;gBAAU;YAAS;YACvD,OAAO,OAAO,KAAK,GACb,SACA;gBACE,IAAI,OAAO,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAU,kBAAkB,OAAO,IAAI,CAAC,KAAK;YAC9E;QACR;IACJ;IACA;;;;;;;;;KASC,GACD,MAAM,MAAM,EAAE,MAAM,EAAE,WAAW,GAAG,EAAE,GAAG,CAAC,CAAC,EAAE;QACzC,MAAO,QAAQ,YAAY,KAAM;YAC7B,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI;YAC9B,uCAAuC;YACvC,IAAI,OAAO,KAAK,EAAE;gBACd,OAAO;YACX,OAEK,IAAI,OAAO,EAAE,CAAC,MAAM,GAAG,GAAG;gBAC3B,OAAO;oBACH,IAAI,IAAI,cAAc;wBAClB,OAAO,IAAI,CAAC,KAAK;wBACjB,QAAkD,OAAO,EAAE;oBAC/D;gBACJ;YACJ;YACA,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;QACvD;QACA,OAAO;YACH,OAAO,OAAO,MAAM,CAAC,IAAI,MAAM,YAAY;gBAAE,QAAQ,OAAO,MAAM;YAAC;QACvE;IACJ;AACJ;AACA;;CAEC,GACD,MAAM,uBAAuB,+JAAO;IAChC;;KAEC,GACD,YAAY,KAAK,CAAE;QACf,KAAK;QACL,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,IAAI,OAAO;QACP,OAAO;IACX;IACA,IAAI,UAAU;QACV,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO;IAC7B;IACA,IAAI,YAAY;QACZ,OAAO,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG;IAC5C;IACA,WAAW;QACP,OAAO,CAAC,0BAA0B,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;IACrF;AACJ;AAIO,MAAM;IACT;;;;;;KAMC,GACD,YAAY,KAAK,CAAE;QACf,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM;IAC5B;IACA;;;;;;KAMC,GACD,KAAK,EAAE,QAAQ,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,EAAE;QACpC,OAAO,IAAA,+LAAmB,EAAC,OAAO,IAAI;IAC1C;AACJ;AACA;;;;;;;CAOC,GACD,MAAM,oBAAoB,CAAC,YAAY,EAAE,OAAO,EAAE,GAClD,8EAA8E;IAC9E,2EAA2E;IAC3E,qBAAqB;IACrB,WAAW,KAAK,CAAC,IAAI,CAAC,CAAC,OAAS,GAAG,IAAI,CAAC,iBAAiB,EAAE,KAAK,GAAG,SAAS;AAQrE,MAAM,iBAAiB,CAAC;IAC3B,MAAM,YAAY,EAAE;IACpB,MAAM,UAAoD,OAAO,OAAO,CAAC;IACzE,KAAK,MAAM,CAAC,KAAK,QAAQ,IAAI,QAAS;QAClC,IAAI,SAAS;YACT,UAAU,IAAI,CAAC;gBAAE;YAAI;QACzB;IACJ;IACA,OAAO;AACX;AAIO,MAAM,cAAc;IACvB,YAAY,CAAC;IACb,WAAW,CAAC;IACZ,UAAU,CAAC;IACX,WAAW,CAAC;IACZ,WAAW,CAAC;IACZ,YAAY,CAAC;IACb,YAAY,CAAC;IACb,cAAc,CAAC;IACf,WAAW,CAAC;AAChB;AAIO,MAAM,gBAAgB;IACzB,KAAK,CAAC;AACV,GACA,kCAAkC","ignoreList":[0]}},
    {"offset": {"line": 1266, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/provider.js"],"sourcesContent":["import * as API from './types.js';\nimport * as Provider from '@storacha/capabilities/provider';\nexport const { Provider: ProviderDID, AccountDID } = Provider;\n/**\n * Provisions specified `space` with the specified `account`. It is expected\n * that delegation from the account authorizing agent is either stored in the\n * agent proofs or provided explicitly.\n *\n * @template {Record<string, any>} [S=API.Service]\n * @param {API.Agent<S>} agent\n * @param {object} input\n * @param {API.AccountDID} input.account - Account provisioning the space.\n * @param {API.SpaceDID} input.consumer - Space been provisioned.\n * @param {API.ProviderDID} [input.provider] - Provider been provisioned.\n * @param {API.Delegation[]} [input.proofs] - Delegation from the account\n * authorizing agent to call `provider/add` capability.\n */\nexport const add = async (agent, { account, consumer, provider = /** @type {API.ProviderDID} */ (agent.connection.id.did()), proofs, }) => {\n    if (!ProviderDID.is(provider)) {\n        throw new Error(`Unable to determine provider from agent.connection.id did ${provider}. expected a did:web:`);\n    }\n    const { out } = await agent.invokeAndExecute(Provider.add, {\n        with: account,\n        nb: {\n            provider,\n            consumer,\n        },\n        proofs,\n    });\n    return out;\n};\n//# sourceMappingURL=provider.js.map"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;;;AACO,MAAM,EAAE,UAAU,WAAW,EAAE,UAAU,EAAE,GAAG;AAe9C,MAAM,MAAM,OAAO,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,WAA2C,MAAM,UAAU,CAAC,EAAE,CAAC,GAAG,EAAG,EAAE,MAAM,EAAG;IAClI,IAAI,CAAC,YAAY,EAAE,CAAC,WAAW;QAC3B,MAAM,IAAI,MAAM,CAAC,0DAA0D,EAAE,SAAS,qBAAqB,CAAC;IAChH;IACA,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,MAAM,gBAAgB,CAAC,kKAAS,GAAG,EAAE;QACvD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;IACJ;IACA,OAAO;AACX,GACA,oCAAoC","ignoreList":[0]}},
    {"offset": {"line": 1298, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/space-access.js"],"sourcesContent":["import * as API from './types.js';\n/**\n * Known valid provider/algorithm combinations\n *\n * @type {Record<string, string[]>}\n */\nconst VALID_COMBINATIONS = {\n    'google-kms': ['RSA_DECRYPT_OAEP_3072_SHA256'],\n    // Add more providers and algorithms here as needed\n};\n/**\n * Space access utilities and validation\n */\nexport class SpaceAccess {\n    /**\n     * Creates and validates a space access configuration\n     *\n     * @template {API.SpaceAccessType} T\n     * @param {T} [access] - The access configuration to validate\n     * @returns {T}\n     * @throws {Error} When access configuration is invalid\n     */\n    static from(access) {\n        if (!access || access.type === 'public') {\n            return /** @type {T} */ ({ type: 'public' });\n        }\n        if (access.type === 'private') {\n            if (!access.encryption) {\n                throw new Error('Private access type requires encryption configuration');\n            }\n            const { provider, algorithm } = access.encryption;\n            if (!VALID_COMBINATIONS[provider]) {\n                throw new Error(`unknown encryption provider: ${provider}`);\n            }\n            if (!VALID_COMBINATIONS[provider].includes(algorithm)) {\n                throw new Error(`unknown encryption algorithm: ${algorithm} for provider: ${provider}`);\n            }\n            return /** @type {T} */ (access);\n        }\n        throw new Error(`unknown access type: ${ /** @type {any} */(access).type}`);\n    }\n    /**\n     * Creates a public space access configuration\n     *\n     * @returns {API.PublicAccess}\n     */\n    static public() {\n        return { type: 'public' };\n    }\n    /**\n     * Creates a private space access configuration with encryption provider\n     *\n     * @param {string} [provider] - The encryption provider. Defaults to `google-kms`.\n     * @param {string} [algorithm] - The encryption algorithm. Defaults to `RSA_DECRYPT_OAEP_3072_SHA256`.\n     * @returns {API.PrivateAccess<API.EncryptionProvider>}\n     * @throws {Error} When provider/algorithm combination is invalid\n     */\n    static private(provider = 'google-kms', algorithm = 'RSA_DECRYPT_OAEP_3072_SHA256') {\n        if (!VALID_COMBINATIONS[provider]) {\n            throw new Error(`unknown encryption provider: ${provider}`);\n        }\n        if (!VALID_COMBINATIONS[provider].includes(algorithm)) {\n            throw new Error(`unknown encryption algorithm: ${algorithm} for provider: ${provider}`);\n        }\n        return {\n            type: 'private',\n            encryption: { provider, algorithm },\n        };\n    }\n}\n//# sourceMappingURL=space-access.js.map"],"names":[],"mappings":";;;;AAAA;;AACA;;;;CAIC,GACD,MAAM,qBAAqB;IACvB,cAAc;QAAC;KAA+B;AAElD;AAIO,MAAM;IACT;;;;;;;KAOC,GACD,OAAO,KAAK,MAAM,EAAE;QAChB,IAAI,CAAC,UAAU,OAAO,IAAI,KAAK,UAAU;YACrC,OAAyB;gBAAE,MAAM;YAAS;QAC9C;QACA,IAAI,OAAO,IAAI,KAAK,WAAW;YAC3B,IAAI,CAAC,OAAO,UAAU,EAAE;gBACpB,MAAM,IAAI,MAAM;YACpB;YACA,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,OAAO,UAAU;YACjD,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE;gBAC/B,MAAM,IAAI,MAAM,CAAC,6BAA6B,EAAE,UAAU;YAC9D;YACA,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,QAAQ,CAAC,YAAY;gBACnD,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,UAAU,eAAe,EAAE,UAAU;YAC1F;YACA,OAAyB;QAC7B;QACA,MAAM,IAAI,MAAM,CAAC,qBAAqB,EAAG,gBAAgB,GAAE,AAAC,OAAQ,IAAI,EAAE;IAC9E;IACA;;;;KAIC,GACD,OAAO,SAAS;QACZ,OAAO;YAAE,MAAM;QAAS;IAC5B;IACA;;;;;;;KAOC,GACD,OAAO,QAAQ,WAAW,YAAY,EAAE,YAAY,8BAA8B,EAAE;QAChF,IAAI,CAAC,kBAAkB,CAAC,SAAS,EAAE;YAC/B,MAAM,IAAI,MAAM,CAAC,6BAA6B,EAAE,UAAU;QAC9D;QACA,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,QAAQ,CAAC,YAAY;YACnD,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,UAAU,eAAe,EAAE,UAAU;QAC1F;QACA,OAAO;YACH,MAAM;YACN,YAAY;gBAAE;gBAAU;YAAU;QACtC;IACJ;AACJ,EACA,wCAAwC","ignoreList":[0]}},
    {"offset": {"line": 1378, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/space.js"],"sourcesContent":["import * as ED25519 from '@ucanto/principal/ed25519';\nimport { delegate, Schema, UCAN, error, fail, DID } from '@ucanto/core';\nimport * as BIP39 from '@scure/bip39';\nimport { wordlist } from '@scure/bip39/wordlists/english';\nimport * as API from './types.js';\nimport * as Access from './access.js';\nimport * as Provider from './provider.js';\nimport { SpaceAccess } from './space-access.js';\n/**\n * Data model for the (owned) space.\n *\n * @typedef {{\n *  signer: ED25519.EdSigner;\n *   name: string;\n *   access?: API.SpaceAccessType;\n *   agent?: API.Agent<S>;\n * }} Model\n * @template {Record<string, any>} [S=API.Service]\n */\n/**\n * Generates a new space.\n *\n * @template {Record<string, any>} [S=API.Service]\n * @param {object} options\n * @param {string} options.name - The name of the space.\n * @param {API.SpaceAccessType} [options.access] - The access type for the space. Defaults to { type: 'public' }.\n * @param {API.Agent<S>} [options.agent]\n */\nexport const generate = async ({ name, access, agent }) => {\n    const { signer } = await ED25519.generate();\n    const normalizedAccess = SpaceAccess.from(access);\n    return new OwnedSpace({ signer, name, access: normalizedAccess, agent });\n};\n/**\n * Recovers space from the saved mnemonic.\n *\n * @param {string} mnemonic\n * @param {object} options\n * @param {string} options.name - Name to give to the recovered space.\n * @param {API.SpaceAccessType} [options.access] - The access type for the space. Defaults to { type: 'public' }.\n * @param {API.Agent} [options.agent]\n */\nexport const fromMnemonic = async (mnemonic, { name, access, agent }) => {\n    // TODO: Improve recovery UX by auto-detecting access type from existing space metadata\n    // or storing access type with space mnemonic. Should default to public if mnemonic\n    // doesn't contain access type information.\n    const secret = BIP39.mnemonicToEntropy(mnemonic, wordlist);\n    const signer = await ED25519.derive(secret);\n    const normalizedAccess = SpaceAccess.from(access);\n    return new OwnedSpace({ signer, name, access: normalizedAccess, agent });\n};\n/**\n * Turns (owned) space into a BIP39 mnemonic that later can be used to recover\n * the space using `fromMnemonic` function.\n *\n * @param {object} space\n * @param {ED25519.EdSigner} space.signer\n */\nexport const toMnemonic = ({ signer }) => {\n    /** @type {Uint8Array} */\n    // @ts-expect-error - Field is defined but not in the interface\n    const secret = signer.secret;\n    return BIP39.entropyToMnemonic(secret, wordlist);\n};\n/**\n * Creates a (UCAN) delegation that gives full access to the space to the\n * specified `account`. At the moment we only allow `did:mailto` principal\n * to be used as an `account`.\n *\n * @template {Record<string, any>} [S=API.Service]\n * @param {Model<S>} space\n * @param {API.AccountDID} account\n */\nexport const createRecovery = (space, account) => createAuthorization(space, {\n    audience: DID.parse(account),\n    access: Access.accountAccess,\n    expiration: Infinity,\n});\n// Default authorization session is valid for 1 year\nexport const SESSION_LIFETIME = 60 * 60 * 24 * 365;\n/**\n * Creates (UCAN) delegation that gives specified `agent` an access to\n * specified ability (passed as `access.can` field) on this space.\n * Optionally, you can specify `access.expiration` field to set the\n * expiration time for the authorization. By default the authorization\n * is valid for 1 year and gives access to all capabilities on the space\n * that are needed to use the space.\n *\n * @template {Record<string, any>} [S=API.Service]\n * @param {Model<S>} space\n * @param {object} options\n * @param {API.Principal} options.audience\n * @param {API.Access} [options.access]\n * @param {API.UTCUnixTimestamp} [options.expiration]\n */\nexport const createAuthorization = async ({ signer, name, access }, { audience, access: spaceAccess = Access.spaceAccess, expiration = UCAN.now() + SESSION_LIFETIME, }) => {\n    const normalizedAccess = SpaceAccess.from(access);\n    const facts = [{ space: { name, access: normalizedAccess } }];\n    return await delegate({\n        issuer: signer,\n        audience: audience,\n        capabilities: toCapabilities({\n            [signer.did()]: spaceAccess,\n        }),\n        ...(expiration ? { expiration } : {}),\n        facts,\n    });\n};\n/**\n * @param {Record<API.Resource, API.Access>} allow\n * @returns {API.Capabilities}\n */\nconst toCapabilities = (allow) => {\n    const capabilities = [];\n    for (const [subject, access] of Object.entries(allow)) {\n        const entries = /** @type {[API.Ability, API.Unit][]} */ (Object.entries(access));\n        for (const [can, details] of entries) {\n            if (details) {\n                capabilities.push({ can, with: subject });\n            }\n        }\n    }\n    return /** @type {API.Capabilities} */ (capabilities);\n};\n/**\n * Represents an owned space, meaning a space for which we have a private key\n * and consequently have full authority over.\n *\n * @template {Record<string, any>} [S=API.Service]\n */\nexport class OwnedSpace {\n    /**\n     * @param {Model<S>} model\n     */\n    constructor(model) {\n        this.model = model;\n    }\n    get signer() {\n        return this.model.signer;\n    }\n    get name() {\n        return this.model.name;\n    }\n    get access() {\n        return SpaceAccess.from(this.model.access);\n    }\n    did() {\n        return this.signer.did();\n    }\n    /**\n     * Creates a renamed version of this space.\n     *\n     * @param {string} name\n     */\n    withName(name) {\n        return new OwnedSpace({\n            signer: this.signer,\n            name,\n            access: this.access,\n        });\n    }\n    /**\n     * Saves account in the agent store so it can be accessed across sessions.\n     *\n     * @param {object} input\n     * @param {API.Agent<S>} [input.agent]\n     * @returns {Promise<API.Result<API.Unit, Error>>}\n     */\n    async save({ agent = this.model.agent } = {}) {\n        if (!agent) {\n            return fail('Please provide an agent to save the space into');\n        }\n        const proof = await createAuthorization(this, { audience: agent });\n        await agent.importSpaceFromDelegation(proof);\n        await agent.setCurrentSpace(this.did());\n        return { ok: {} };\n    }\n    /**\n     * @param {Authorization} authorization\n     * @param {object} options\n     * @param {API.Agent<S>} [options.agent]\n     */\n    provision({ proofs }, { agent = this.model.agent } = {}) {\n        if (!agent) {\n            return fail('Please provide an agent to save the space into');\n        }\n        return provision(this, { proofs, agent });\n    }\n    /**\n     * Creates a (UCAN) delegation that gives full access to the space to the\n     * specified `account`. At the moment we only allow `did:mailto` principal\n     * to be used as an `account`.\n     *\n     * @param {API.AccountDID} account\n     */\n    async createRecovery(account) {\n        return createRecovery(this, account);\n    }\n    /**\n     * Creates (UCAN) delegation that gives specified `agent` an access to\n     * specified ability (passed as `access.can` field) on the this space.\n     * Optionally, you can specify `access.expiration` field to set the\n     *\n     * @param {API.Principal} principal\n     * @param {object} [input]\n     * @param {API.Access} [input.access]\n     * @param {API.UCAN.UTCUnixTimestamp} [input.expiration]\n     */\n    createAuthorization(principal, input) {\n        return createAuthorization(this, { ...input, audience: principal });\n    }\n    /**\n     * Derives BIP39 mnemonic that can be used to recover the space.\n     *\n     * @returns {string}\n     */\n    toMnemonic() {\n        return toMnemonic(this);\n    }\n}\nconst SpaceDID = Schema.did({ method: 'key' });\n/**\n * Creates a (shared) space from given delegation.\n *\n * @param {API.Delegation} delegation\n */\nexport const fromDelegation = (delegation) => {\n    const result = SpaceDID.read(delegation.capabilities[0].with);\n    if (result.error) {\n        throw Object.assign(new Error(`Invalid delegation, expected capabilities[0].with to be DID, ${result.error}`), {\n            cause: result.error,\n        });\n    }\n    /** @type {{name?:string, access?:API.SpaceAccessType}} */\n    const meta = delegation.facts[0]?.space ?? {};\n    // Ensure access defaults to public for backwards compatibility\n    meta.access = SpaceAccess.from(meta.access);\n    return new SharedSpace({ id: result.ok, delegation, meta });\n};\n/**\n * @typedef {object} Authorization\n * @property {API.Delegation[]} proofs\n *\n * @typedef {object} Space\n * @property {() => API.SpaceDID} did\n */\n/**\n * @template {Record<string, any>} [S=API.Service]\n * @param {Space} space\n * @param {object} options\n * @param {API.Delegation[]} options.proofs\n * @param {API.Agent<S>} options.agent\n */\nexport const provision = async (space, { proofs, agent }) => {\n    const [capability] = proofs[0].capabilities;\n    const { ok: account, error: reason } = Provider.AccountDID.read(capability.with);\n    if (reason) {\n        return error(reason);\n    }\n    return await Provider.add(agent, {\n        consumer: space.did(),\n        account,\n        proofs,\n    });\n};\n/**\n * Represents a shared space, meaning a space for which we have a delegation\n * and consequently have limited authority over.\n */\nexport class SharedSpace {\n    /**\n     * @typedef {object} SharedSpaceModel\n     * @property {API.SpaceDID} id\n     * @property {API.Delegation} delegation\n     * @property {{name?:string, access?:API.SpaceAccessType}} meta\n     * @property {API.Agent} [agent]\n     *\n     * @param {SharedSpaceModel} model\n     */\n    constructor(model) {\n        this.model = model;\n    }\n    get delegation() {\n        return this.model.delegation;\n    }\n    get meta() {\n        return this.model.meta;\n    }\n    get name() {\n        return this.meta.name ?? '';\n    }\n    get access() {\n        return SpaceAccess.from(this.meta.access);\n    }\n    did() {\n        return this.model.id;\n    }\n    /**\n     * @param {string} name\n     */\n    withName(name) {\n        return new SharedSpace({\n            ...this.model,\n            meta: { ...this.meta, name, access: this.access },\n        });\n    }\n}\n//# sourceMappingURL=space.js.map"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAqBO,MAAM,WAAW,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE;IAClD,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,gLAAgB;IACzC,MAAM,mBAAmB,iLAAW,CAAC,IAAI,CAAC;IAC1C,OAAO,IAAI,WAAW;QAAE;QAAQ;QAAM,QAAQ;QAAkB;IAAM;AAC1E;AAUO,MAAM,eAAe,OAAO,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE;IAChE,uFAAuF;IACvF,mFAAmF;IACnF,2CAA2C;IAC3C,MAAM,SAAS,wKAAuB,CAAC,UAAU,8KAAQ;IACzD,MAAM,SAAS,MAAM,8KAAc,CAAC;IACpC,MAAM,mBAAmB,iLAAW,CAAC,IAAI,CAAC;IAC1C,OAAO,IAAI,WAAW;QAAE;QAAQ;QAAM,QAAQ;QAAkB;IAAM;AAC1E;AAQO,MAAM,aAAa,CAAC,EAAE,MAAM,EAAE;IACjC,uBAAuB,GACvB,+DAA+D;IAC/D,MAAM,SAAS,OAAO,MAAM;IAC5B,OAAO,wKAAuB,CAAC,QAAQ,8KAAQ;AACnD;AAUO,MAAM,iBAAiB,CAAC,OAAO,UAAY,oBAAoB,OAAO;QACzE,UAAU,4LAAG,CAAC,KAAK,CAAC;QACpB,QAAQ,0KAAoB;QAC5B,YAAY;IAChB;AAEO,MAAM,mBAAmB,KAAK,KAAK,KAAK;AAgBxC,MAAM,sBAAsB,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,cAAc,wKAAkB,EAAE,aAAa,8LAAI,CAAC,GAAG,KAAK,gBAAgB,EAAG;IACnK,MAAM,mBAAmB,iLAAW,CAAC,IAAI,CAAC;IAC1C,MAAM,QAAQ;QAAC;YAAE,OAAO;gBAAE;gBAAM,QAAQ;YAAiB;QAAE;KAAE;IAC7D,OAAO,MAAM,IAAA,oKAAQ,EAAC;QAClB,QAAQ;QACR,UAAU;QACV,cAAc,eAAe;YACzB,CAAC,OAAO,GAAG,GAAG,EAAE;QACpB;QACA,GAAI,aAAa;YAAE;QAAW,IAAI,CAAC,CAAC;QACpC;IACJ;AACJ;AACA;;;CAGC,GACD,MAAM,iBAAiB,CAAC;IACpB,MAAM,eAAe,EAAE;IACvB,KAAK,MAAM,CAAC,SAAS,OAAO,IAAI,OAAO,OAAO,CAAC,OAAQ;QACnD,MAAM,UAAoD,OAAO,OAAO,CAAC;QACzE,KAAK,MAAM,CAAC,KAAK,QAAQ,IAAI,QAAS;YAClC,IAAI,SAAS;gBACT,aAAa,IAAI,CAAC;oBAAE;oBAAK,MAAM;gBAAQ;YAC3C;QACJ;IACJ;IACA,OAAwC;AAC5C;AAOO,MAAM;IACT;;KAEC,GACD,YAAY,KAAK,CAAE;QACf,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM;IAC5B;IACA,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI;IAC1B;IACA,IAAI,SAAS;QACT,OAAO,iLAAW,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM;IAC7C;IACA,MAAM;QACF,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG;IAC1B;IACA;;;;KAIC,GACD,SAAS,IAAI,EAAE;QACX,OAAO,IAAI,WAAW;YAClB,QAAQ,IAAI,CAAC,MAAM;YACnB;YACA,QAAQ,IAAI,CAAC,MAAM;QACvB;IACJ;IACA;;;;;;KAMC,GACD,MAAM,KAAK,EAAE,QAAQ,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,EAAE;QAC1C,IAAI,CAAC,OAAO;YACR,OAAO,IAAA,4JAAI,EAAC;QAChB;QACA,MAAM,QAAQ,MAAM,oBAAoB,IAAI,EAAE;YAAE,UAAU;QAAM;QAChE,MAAM,MAAM,yBAAyB,CAAC;QACtC,MAAM,MAAM,eAAe,CAAC,IAAI,CAAC,GAAG;QACpC,OAAO;YAAE,IAAI,CAAC;QAAE;IACpB;IACA;;;;KAIC,GACD,UAAU,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,EAAE;QACrD,IAAI,CAAC,OAAO;YACR,OAAO,IAAA,4JAAI,EAAC;QAChB;QACA,OAAO,UAAU,IAAI,EAAE;YAAE;YAAQ;QAAM;IAC3C;IACA;;;;;;KAMC,GACD,MAAM,eAAe,OAAO,EAAE;QAC1B,OAAO,eAAe,IAAI,EAAE;IAChC;IACA;;;;;;;;;KASC,GACD,oBAAoB,SAAS,EAAE,KAAK,EAAE;QAClC,OAAO,oBAAoB,IAAI,EAAE;YAAE,GAAG,KAAK;YAAE,UAAU;QAAU;IACrE;IACA;;;;KAIC,GACD,aAAa;QACT,OAAO,WAAW,IAAI;IAC1B;AACJ;AACA,MAAM,WAAW,gMAAM,CAAC,GAAG,CAAC;IAAE,QAAQ;AAAM;AAMrC,MAAM,iBAAiB,CAAC;IAC3B,MAAM,SAAS,SAAS,IAAI,CAAC,WAAW,YAAY,CAAC,EAAE,CAAC,IAAI;IAC5D,IAAI,OAAO,KAAK,EAAE;QACd,MAAM,OAAO,MAAM,CAAC,IAAI,MAAM,CAAC,6DAA6D,EAAE,OAAO,KAAK,EAAE,GAAG;YAC3G,OAAO,OAAO,KAAK;QACvB;IACJ;IACA,wDAAwD,GACxD,MAAM,OAAO,WAAW,KAAK,CAAC,EAAE,EAAE,SAAS,CAAC;IAC5C,+DAA+D;IAC/D,KAAK,MAAM,GAAG,iLAAW,CAAC,IAAI,CAAC,KAAK,MAAM;IAC1C,OAAO,IAAI,YAAY;QAAE,IAAI,OAAO,EAAE;QAAE;QAAY;IAAK;AAC7D;AAeO,MAAM,YAAY,OAAO,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE;IACpD,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,EAAE,CAAC,YAAY;IAC3C,MAAM,EAAE,IAAI,OAAO,EAAE,OAAO,MAAM,EAAE,GAAG,yKAAmB,CAAC,IAAI,CAAC,WAAW,IAAI;IAC/E,IAAI,QAAQ;QACR,OAAO,IAAA,6JAAK,EAAC;IACjB;IACA,OAAO,MAAM,kKAAY,CAAC,OAAO;QAC7B,UAAU,MAAM,GAAG;QACnB;QACA;IACJ;AACJ;AAKO,MAAM;IACT;;;;;;;;KAQC,GACD,YAAY,KAAK,CAAE;QACf,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,IAAI,aAAa;QACb,OAAO,IAAI,CAAC,KAAK,CAAC,UAAU;IAChC;IACA,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI;IAC1B;IACA,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI;IAC7B;IACA,IAAI,SAAS;QACT,OAAO,iLAAW,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM;IAC5C;IACA,MAAM;QACF,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE;IACxB;IACA;;KAEC,GACD,SAAS,IAAI,EAAE;QACX,OAAO,IAAI,YAAY;YACnB,GAAG,IAAI,CAAC,KAAK;YACb,MAAM;gBAAE,GAAG,IAAI,CAAC,IAAI;gBAAE;gBAAM,QAAQ,IAAI,CAAC,MAAM;YAAC;QACpD;IACJ;AACJ,EACA,iCAAiC","ignoreList":[0]}},
    {"offset": {"line": 1665, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/delegations.js"],"sourcesContent":["import * as ucanto from '@ucanto/core';\nimport * as API from './types.js';\nimport { canDelegateAbility } from '@storacha/capabilities/utils';\n/**\n *\n * @param {API.Delegation} delegation\n */\nexport function isExpired(delegation) {\n    if (delegation.expiration === undefined ||\n        delegation.expiration <= Math.floor(Date.now() / 1000)) {\n        return true;\n    }\n    return false;\n}\n/**\n *\n * @param {API.Delegation} delegation\n */\nexport function isTooEarly(delegation) {\n    if (!delegation.notBefore) {\n        return false;\n    }\n    return delegation.notBefore > Math.floor(Date.now() / 1000);\n}\n/**\n *\n * @param {API.Delegation} delegation\n * @param {object} [opts]\n * @param {API.Principal} [opts.checkAudience]\n * @param {boolean} [opts.checkIsExpired]\n * @param {boolean} [opts.checkIsTooEarly]\n */\nexport function validate(delegation, opts) {\n    const { checkAudience, checkIsExpired = true, checkIsTooEarly = true, } = opts ?? {};\n    if (checkAudience && delegation.audience.did() !== checkAudience.did()) {\n        throw new Error(`Delegation audience ${delegation.audience.did()} does not match required DID ${checkAudience.did()}`);\n    }\n    if (checkIsExpired && isExpired(delegation)) {\n        throw new Error(`Delegation expired.`);\n    }\n    if (checkIsTooEarly && isTooEarly(delegation)) {\n        throw new Error(`Delegation is not active yet (too early).`);\n    }\n}\n/**\n * Returns true if the delegation includes capability been queried.\n *\n * @param {API.Delegation} delegation\n * @param {API.CapabilityQuery} capability\n */\nexport function canDelegateCapability(delegation, capability) {\n    const allowsCapabilities = ucanto.Delegation.allows(delegation);\n    for (const [uri, abilities] of Object.entries(allowsCapabilities)) {\n        if (matchResource(/** @type {API.Resource} */ (uri), capability.with)) {\n            const cans = /** @type {API.Ability[]} */ (Object.keys(abilities));\n            for (const can of cans) {\n                if (canDelegateAbility(can, capability.can)) {\n                    return true;\n                }\n            }\n        }\n    }\n    return false;\n}\n/**\n * Returns true if given `resource` matches the resource query per UCAN\n * specification.\n *\n * @param {API.Resource} resource\n * @param {API.ResourceQuery} query\n */\nexport const matchResource = (resource, query) => {\n    if (query === 'ucan:*') {\n        return true;\n    }\n    else if (typeof query === 'string') {\n        return resource === query;\n    }\n    else {\n        return query.test(resource);\n    }\n};\n//# sourceMappingURL=delegations.js.map"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AACA;AACA;;;;AAKO,SAAS,UAAU,UAAU;IAChC,IAAI,WAAW,UAAU,KAAK,aAC1B,WAAW,UAAU,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,OAAO;QACxD,OAAO;IACX;IACA,OAAO;AACX;AAKO,SAAS,WAAW,UAAU;IACjC,IAAI,CAAC,WAAW,SAAS,EAAE;QACvB,OAAO;IACX;IACA,OAAO,WAAW,SAAS,GAAG,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;AAC1D;AASO,SAAS,SAAS,UAAU,EAAE,IAAI;IACrC,MAAM,EAAE,aAAa,EAAE,iBAAiB,IAAI,EAAE,kBAAkB,IAAI,EAAG,GAAG,QAAQ,CAAC;IACnF,IAAI,iBAAiB,WAAW,QAAQ,CAAC,GAAG,OAAO,cAAc,GAAG,IAAI;QACpE,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,WAAW,QAAQ,CAAC,GAAG,GAAG,6BAA6B,EAAE,cAAc,GAAG,IAAI;IACzH;IACA,IAAI,kBAAkB,UAAU,aAAa;QACzC,MAAM,IAAI,MAAM,CAAC,mBAAmB,CAAC;IACzC;IACA,IAAI,mBAAmB,WAAW,aAAa;QAC3C,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC/D;AACJ;AAOO,SAAS,sBAAsB,UAAU,EAAE,UAAU;IACxD,MAAM,qBAAqB,4MAAiB,CAAC,MAAM,CAAC;IACpD,KAAK,MAAM,CAAC,KAAK,UAAU,IAAI,OAAO,OAAO,CAAC,oBAAqB;QAC/D,IAAI,cAA2C,KAAM,WAAW,IAAI,GAAG;YACnE,MAAM,OAAqC,OAAO,IAAI,CAAC;YACvD,KAAK,MAAM,OAAO,KAAM;gBACpB,IAAI,IAAA,oLAAkB,EAAC,KAAK,WAAW,GAAG,GAAG;oBACzC,OAAO;gBACX;YACJ;QACJ;IACJ;IACA,OAAO;AACX;AAQO,MAAM,gBAAgB,CAAC,UAAU;IACpC,IAAI,UAAU,UAAU;QACpB,OAAO;IACX,OACK,IAAI,OAAO,UAAU,UAAU;QAChC,OAAO,aAAa;IACxB,OACK;QACD,OAAO,MAAM,IAAI,CAAC;IACtB;AACJ,GACA,uCAAuC","ignoreList":[0]}},
    {"offset": {"line": 1735, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/utils/buffers.js"],"sourcesContent":["/**\n * Convert a Uint8Array to an ArrayBuffer, taking into account\n * that we may be looking at a \"data view\".\n * thanks, https://stackoverflow.com/a/54646864\n *\n * If we aren't looking at a data view, simply returns the underlying ArrayBuffer\n * directly.\n *\n * @param {Uint8Array} array\n * @returns ArrayBuffer\n */\nexport function uint8ArrayToArrayBuffer(array) {\n    if (array.byteOffset === 0 && array.byteLength === array.buffer.byteLength) {\n        return array.buffer;\n    }\n    else {\n        return array.buffer.slice(array.byteOffset, array.byteLength + array.byteOffset);\n    }\n}\n//# sourceMappingURL=buffers.js.map"],"names":[],"mappings":"AAAA;;;;;;;;;;CAUC;;;;AACM,SAAS,wBAAwB,KAAK;IACzC,IAAI,MAAM,UAAU,KAAK,KAAK,MAAM,UAAU,KAAK,MAAM,MAAM,CAAC,UAAU,EAAE;QACxE,OAAO,MAAM,MAAM;IACvB,OACK;QACD,OAAO,MAAM,MAAM,CAAC,KAAK,CAAC,MAAM,UAAU,EAAE,MAAM,UAAU,GAAG,MAAM,UAAU;IACnF;AACJ,EACA,mCAAmC","ignoreList":[0]}},
    {"offset": {"line": 1760, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/agent-data.js"],"sourcesContent":["import { Signer } from '@ucanto/principal';\nimport { Signer as EdSigner } from '@ucanto/principal/ed25519';\nimport { importDAG } from '@ucanto/core/delegation';\nimport * as Ucanto from '@ucanto/interface';\nimport { CID } from 'multiformats';\nimport { UCAN } from '@storacha/capabilities';\nimport { isExpired } from './delegations.js';\nimport { uint8ArrayToArrayBuffer } from './utils/buffers.js';\n/** @typedef {import('./types.js').AgentDataModel} AgentDataModel */\n/** @implements {AgentDataModel} */\nexport class AgentData {\n    /** @type {(data: import('./types.js').AgentDataExport) => Promise<void> | void} */\n    #save;\n    /**\n     * @param {import('./types.js').AgentDataModel} data\n     * @param {import('./types.js').AgentDataOptions} [options]\n     */\n    constructor(data, options = {}) {\n        this.meta = data.meta;\n        this.principal = data.principal;\n        this.spaces = data.spaces;\n        this.delegations = data.delegations;\n        this.currentSpace = data.currentSpace;\n        this.#save = (data) => options.store ? options.store.save(data) : undefined;\n    }\n    /**\n     * Create a new AgentData instance from the passed initialization data.\n     *\n     * @param {Partial<import('./types.js').AgentDataModel>} [init]\n     * @param {import('./types.js').AgentDataOptions} [options]\n     */\n    static async create(init = {}, options = {}) {\n        const agentData = new AgentData({\n            meta: { name: 'agent', type: 'device', ...init.meta },\n            principal: init.principal ?? (await EdSigner.generate()),\n            spaces: init.spaces ?? new Map(),\n            delegations: init.delegations ?? new Map(),\n            currentSpace: init.currentSpace,\n        }, options);\n        if (options.store) {\n            await options.store.save(agentData.export());\n        }\n        return agentData;\n    }\n    /**\n     * Instantiate AgentData from previously exported data.\n     *\n     * @param {import('./types.js').AgentDataExport} raw\n     * @param {import('./types.js').AgentDataOptions} [options]\n     */\n    static fromExport(raw, options) {\n        /** @type {import('./types.js').AgentDataModel['delegations']} */\n        const dels = new Map();\n        for (const [key, value] of raw.delegations) {\n            dels.set(key, {\n                delegation: importDAG(value.delegation.map((d) => ({\n                    cid: CID.parse(d.cid).toV1(),\n                    bytes: d.bytes instanceof Uint8Array ? d.bytes : new Uint8Array(d.bytes),\n                }))),\n                meta: value.meta,\n            });\n        }\n        return new AgentData({\n            meta: raw.meta,\n            // @ts-expect-error for some reason TS thinks this is a EdSigner\n            principal: Signer.from(raw.principal),\n            currentSpace: raw.currentSpace,\n            spaces: raw.spaces,\n            delegations: dels,\n        }, options);\n    }\n    /**\n     * Export data in a format safe to pass to `structuredClone()`.\n     */\n    export() {\n        /** @type {import('./types.js').AgentDataExport} */\n        const raw = {\n            meta: this.meta,\n            principal: this.principal.toArchive(),\n            currentSpace: this.currentSpace,\n            spaces: this.spaces,\n            delegations: new Map(),\n        };\n        for (const [key, value] of this.delegations) {\n            raw.delegations.set(key, {\n                meta: value.meta,\n                delegation: [...value.delegation.export()].map((b) => ({\n                    cid: b.cid.toString(),\n                    bytes: uint8ArrayToArrayBuffer(b.bytes),\n                })),\n            });\n        }\n        return raw;\n    }\n    /**\n     * @param {import('@ucanto/interface').DID} did\n     * @param {import('./types.js').SpaceMeta} meta\n     * @param {import('@ucanto/interface').Delegation} [proof]\n     */\n    async addSpace(did, meta, proof) {\n        this.spaces.set(did, meta);\n        await (proof ? this.addDelegation(proof) : this.#save(this.export()));\n    }\n    /**\n     * @deprecated\n     * @param {import('@ucanto/interface').DID<'key'>} did\n     */\n    async setCurrentSpace(did) {\n        this.currentSpace = did;\n        await this.#save(this.export());\n    }\n    /**\n     * @param {import('@ucanto/interface').Delegation} delegation\n     * @param {import('./types.js').DelegationMeta} [meta]\n     */\n    async addDelegation(delegation, meta) {\n        this.delegations.set(delegation.cid.toString(), {\n            delegation,\n            meta: meta ?? {},\n        });\n        await this.#save(this.export());\n    }\n    /**\n     * @param {import('@ucanto/interface').UCANLink} cid\n     */\n    async removeDelegation(cid) {\n        this.delegations.delete(cid.toString());\n        await this.#save(this.export());\n    }\n}\n/**\n * Is the given capability a session attestation?\n *\n * @param {Ucanto.Capability} cap\n * @returns {boolean}\n */\nconst isSessionCapability = (cap) => cap.can === UCAN.attest.can;\n/**\n * Is the given delegation a session proof?\n *\n * @param {Ucanto.Delegation} delegation\n * @returns {delegation is Ucanto.Delegation<[import('./types.js').UCANAttest]>}\n */\nexport const isSessionProof = (delegation) => delegation.capabilities.some((cap) => isSessionCapability(cap));\n/**\n * @typedef {string} SessionProofAuthorizationCid - the nb.proof CID of the ucan/attest in the session proof\n * @typedef {Ucanto.DID} SessionProofIssuer - issuer of ucan/attest session proof\n * @typedef {Record<SessionProofAuthorizationCid, Record<SessionProofIssuer, [Ucanto.Delegation, ...Ucanto.Delegation[]]>>} SessionProofIndexedByAuthorizationAndIssuer\n */\n/**\n * Get a map from CIDs to the session proofs that reference them\n *\n * @param {AgentData} data\n * @returns {SessionProofIndexedByAuthorizationAndIssuer}\n */\nexport function getSessionProofs(data) {\n    /** @type {SessionProofIndexedByAuthorizationAndIssuer} */\n    const proofs = {};\n    for (const { delegation } of data.delegations.values()) {\n        if (isSessionProof(delegation)) {\n            const cap = delegation.capabilities[0];\n            if (cap && !isExpired(delegation)) {\n                const proof = cap.nb.proof;\n                if (proof) {\n                    const proofCid = proof.toString();\n                    const issuerDid = delegation.issuer.did();\n                    proofs[proofCid] = proofs[proofCid] ?? {};\n                    proofs[proofCid][issuerDid] = proofs[proofCid][issuerDid] ?? [];\n                    proofs[proofCid][issuerDid].push(delegation);\n                }\n            }\n        }\n    }\n    return proofs;\n}\n//# sourceMappingURL=agent-data.js.map"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1932, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/agent-use-cases.js"],"sourcesContent":["import { addSpacesFromDelegations, Agent as AccessAgent } from './agent.js';\nimport * as Access from '@storacha/capabilities/access';\nimport { bytesToDelegations } from './encoding.js';\nimport { Provider, Plan } from '@storacha/capabilities';\nimport * as w3caps from '@storacha/capabilities';\nimport { Schema, delegate } from '@ucanto/core';\nimport { AgentData, isSessionProof } from './agent-data.js';\nimport * as DidMailto from '@storacha/did-mailto';\nimport * as API from './types.js';\nconst DIDWeb = Schema.DID.match({ method: 'web' });\n/**\n * Request access by a session allowing this agent to issue UCANs\n * signed by the account.\n *\n * @param {AccessAgent} access\n * @param {API.Principal<API.AccountDID>} account\n * @param {Iterable<{ can: API.Ability }>} capabilities\n */\nexport async function requestAccess(access, account, capabilities) {\n    const res = await access.invokeAndExecute(Access.authorize, {\n        audience: access.connection.id,\n        with: access.issuer.did(),\n        nb: {\n            iss: account.did(),\n            att: [...capabilities],\n        },\n    });\n    if (res?.out.error) {\n        throw res.out.error;\n    }\n}\n/**\n * claim delegations delegated to an audience\n *\n * @param {AccessAgent} access\n * @param {API.DID} [audienceOfClaimedDelegations] - audience of claimed delegations. defaults to access.connection.id.did()\n * @param {object} opts\n * @param {string} [opts.nonce] - nonce to use for the claim\n * @param {boolean} [opts.addProofs] - whether to addProof to access agent\n */\nexport async function claimAccess(access, audienceOfClaimedDelegations = access.connection.id.did(), { addProofs = false, nonce } = {}) {\n    const res = await access.invokeAndExecute(Access.claim, {\n        audience: access.connection.id,\n        with: audienceOfClaimedDelegations,\n        nonce,\n    });\n    if (res.out.error) {\n        throw res.out.error;\n    }\n    const delegations = Object.values(res.out.ok.delegations).flatMap((bytes) => bytesToDelegations(bytes));\n    if (addProofs) {\n        for (const d of delegations) {\n            await access.addProof(d);\n        }\n        await addSpacesFromDelegations(access, delegations);\n    }\n    return delegations;\n}\n/**\n * @param {object} opts\n * @param {AccessAgent} opts.access\n * @param {API.SpaceDID} opts.space\n * @param {API.Principal<API.AccountDID>} opts.account\n * @param {API.ProviderDID} opts.provider - e.g. 'did:web:staging.storacha.network'\n */\nexport async function addProvider({ access, space, account, provider }) {\n    const result = await access.invokeAndExecute(Provider.add, {\n        audience: access.connection.id,\n        with: account.did(),\n        nb: {\n            provider,\n            consumer: space,\n        },\n    });\n    if (result.out.error) {\n        throw result.out.error;\n    }\n}\n/**\n * @typedef {(delegations: API.Delegation[]) => boolean} DelegationsChecker\n */\n/**\n * @type DelegationsChecker\n */\nexport function delegationsIncludeSessionProof(delegations) {\n    return delegations.some((d) => isSessionProof(d));\n}\n/**\n * @param {DelegationsChecker} delegationsMatch\n * @param {AccessAgent} access\n * @param {API.DID} delegee\n * @param {object} [opts]\n * @param {number} [opts.interval]\n * @param {AbortSignal} [opts.signal]\n * @returns {Promise<Iterable<API.Delegation>>}\n */\nexport async function pollAccessClaimUntil(delegationsMatch, access, delegee, opts) {\n    const interval = opts?.interval || 250;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        if (opts?.signal?.aborted)\n            throw opts.signal.reason ?? new Error('operation aborted');\n        const res = await access.invokeAndExecute(w3caps.Access.claim, {\n            with: delegee,\n        });\n        if (res.out.error)\n            throw res.out.error;\n        const claims = Object.values(res.out.ok.delegations).flatMap((d) => bytesToDelegations(d));\n        if (delegationsMatch(claims))\n            return claims;\n        await new Promise((resolve) => setTimeout(resolve, interval));\n    }\n}\n/**\n * @template [T={}]\n * @typedef {{ signal?: AbortSignal } & T} AuthorizationWaiterOpts\n */\n/**\n * @template [U={}]\n * @typedef {(accessAgent: AccessAgent, opts: AuthorizationWaiterOpts<U>) => Promise<Iterable<API.Delegation>>} AuthorizationWaiter\n */\n/**\n * Wait for authorization process to complete by polling executions of the\n * `access/claim` capability and waiting for the result to include\n * a session delegation.\n *\n * @type AuthorizationWaiter<{interval?: number}>\n */\nexport async function waitForAuthorizationByPolling(access, opts = {}) {\n    const claimed = await pollAccessClaimUntil(delegationsIncludeSessionProof, access, access.issuer.did(), {\n        signal: opts?.signal,\n        interval: opts?.interval,\n    });\n    return [...claimed];\n}\n/**\n * Request authorization of a session allowing this agent to issue UCANs\n * signed by the passed email address.\n *\n * @param {AccessAgent} access\n * @param {`${string}@${string}`} email\n * @param {object} [opts]\n * @param {AbortSignal} [opts.signal]\n * @param {boolean} [opts.dontAddProofs] - whether to skip adding proofs to the agent\n * @param {Iterable<{ can: API.Ability }>} [opts.capabilities]\n * @param {AuthorizationWaiter} [opts.expectAuthorization] - function that will resolve once account has confirmed the authorization request\n */\nexport async function authorizeAndWait(access, email, opts = {}) {\n    const expectAuthorization = opts.expectAuthorization || waitForAuthorizationByPolling;\n    const account = { did: () => DidMailto.fromEmail(email) };\n    await requestAccess(access, account, opts?.capabilities || [\n        { can: 'assert/*' },\n        { can: 'space/*' },\n        { can: 'store/*' },\n        { can: 'provider/add' },\n        { can: 'subscription/list' },\n        { can: 'upload/*' },\n        { can: 'ucan/*' },\n        { can: 'plan/*' },\n        { can: 'usage/*' },\n        { can: 'w3up/*' },\n    ]);\n    const sessionDelegations = [...(await expectAuthorization(access, opts))];\n    if (!opts?.dontAddProofs) {\n        await Promise.all(sessionDelegations.map(async (d) => access.addProof(d)));\n    }\n}\n/**\n * Request authorization of a session allowing this agent to issue UCANs\n * signed by the passed email address.\n *\n * @param {AccessAgent} accessAgent\n * @param {`${string}@${string}`} email\n * @param {object} [opts]\n * @param {AbortSignal} [opts.signal]\n * @param {Iterable<{ can: API.Ability }>} [opts.capabilities]\n * @param {boolean} [opts.addProofs]\n * @param {AuthorizationWaiter} [opts.expectAuthorization] - function that will resolve once account has confirmed the authorization request\n */\nexport async function authorizeWaitAndClaim(accessAgent, email, opts) {\n    await authorizeAndWait(accessAgent, email, opts);\n    await claimAccess(accessAgent, accessAgent.issuer.did(), {\n        addProofs: opts?.addProofs ?? true,\n    });\n}\n/**\n * Provisions space with the specified account and sets up a recovery with the\n * same account.\n *\n * @param {AccessAgent} access\n * @param {AgentData} agentData\n * @param {string} email\n * @param {object} [opts]\n * @param {AbortSignal} [opts.signal]\n * @param {API.DID<'key'>} [opts.space]\n * @param {API.ProviderDID} [opts.provider] - provider to register - defaults to this.connection.id\n */\nexport async function addProviderAndDelegateToAccount(access, agentData, email, opts) {\n    const space = opts?.space || access.currentSpace();\n    const spaceMeta = space ? agentData.spaces.get(space) : undefined;\n    const provider = opts?.provider ||\n        (() => {\n            const service = access.connection.id.did();\n            if (DIDWeb.is(service)) {\n                // connection.id did is a valid provider value. Try using that.\n                return service;\n            }\n            throw new Error(`unable to determine provider to use to addProviderAndDelegateToAccount using access.connection.id did ${service}. expected a did:web:`);\n        })();\n    if (!space || !spaceMeta) {\n        throw new Error('No space selected');\n    }\n    if (spaceMeta) {\n        throw new Error('Space already registered with storacha.network.');\n    }\n    const account = { did: () => DidMailto.fromEmail(DidMailto.email(email)) };\n    await addProvider({ access, space, account, provider });\n    const delegateSpaceAccessResult = await delegateSpaceAccessToAccount(access, space, account);\n    if (delegateSpaceAccessResult.out.error) {\n        throw delegateSpaceAccessResult.out.error;\n    }\n    await agentData.addSpace(space, spaceMeta);\n}\n/**\n * @param {AccessAgent} access\n * @param {API.SpaceDID} space\n * @param {API.Principal<API.AccountDID>} account\n */\nasync function delegateSpaceAccessToAccount(access, space, account) {\n    const issuerSaysAccountCanAdminSpace = await createIssuerSaysAccountCanAdminSpace(access.issuer, space, account, undefined, access.proofs([{ with: space, can: '*' }]), \n    // we want to sign over control of this space forever\n    Infinity);\n    return access.invokeAndExecute(Access.delegate, {\n        audience: access.connection.id,\n        with: space,\n        expiration: Infinity,\n        nb: {\n            delegations: {\n                [issuerSaysAccountCanAdminSpace.cid.toString()]: issuerSaysAccountCanAdminSpace.cid,\n            },\n        },\n        proofs: [\n            // must be embedded here because it's referenced by cid in .nb.delegations\n            issuerSaysAccountCanAdminSpace,\n        ],\n    });\n}\n/**\n * @param {API.Signer<API.DIDKey>} issuer\n * @param {API.SpaceDID} space\n * @param {API.Principal<API.AccountDID>} account\n * @param {API.Capabilities} capabilities\n * @param {API.Delegation[]} proofs\n * @param {number} expiration\n * @returns\n */\nasync function createIssuerSaysAccountCanAdminSpace(issuer, space, account, capabilities = [\n    {\n        can: '*',\n        with: space,\n    },\n], proofs = [], expiration) {\n    return delegate({\n        issuer,\n        audience: account,\n        capabilities,\n        proofs,\n        expiration,\n    });\n}\n/**\n *\n * @param {AccessAgent} agent\n * @param {API.AccountDID} account\n */\nexport async function getAccountPlan(agent, account) {\n    const receipt = await agent.invokeAndExecute(Plan.get, {\n        with: account,\n    });\n    return receipt.out;\n}\n//# sourceMappingURL=agent-use-cases.js.map"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2192, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/agent.js"],"sourcesContent":["import * as Client from '@ucanto/client';\nimport * as CAR from '@ucanto/transport/car';\nimport * as HTTP from '@ucanto/transport/http';\nimport * as ucanto from '@ucanto/core';\nimport * as Capabilities from '@storacha/capabilities/space';\nimport { attest } from '@storacha/capabilities/ucan';\nimport * as Access from './access.js';\nimport * as Space from './space.js';\nimport { invoke, delegate, DID, Delegation, Schema, isDelegation, } from '@ucanto/core';\nimport { isExpired, isTooEarly, canDelegateCapability } from './delegations.js';\nimport { AgentData, getSessionProofs } from './agent-data.js';\nimport { UCAN } from '@storacha/capabilities';\nimport * as API from './types.js';\nexport * from './types.js';\nexport * from './delegations.js';\nexport { AgentData, Access, Space, Delegation, Schema };\nexport * from './agent-use-cases.js';\nconst HOST = 'https://up.storacha.network';\nconst PRINCIPAL = DID.parse('did:web:up.storacha.network');\n/**\n * Default identities for the service, including the primary identity.\n *\n * @type {API.DID[]}\n */\nconst IDENTITIES = [PRINCIPAL.did(), 'did:web:web3.storage'];\n/**\n * Keeps track of AgentData for all Agents constructed.\n * Used by addSpacesFromDelegations - so it can only accept Agent as param, but\n * still mutate corresponding AgentData\n *\n * @deprecated - remove this when deprecated addSpacesFromDelegations is removed\n */\n/** @type {WeakMap<Agent<Record<string, any>>, AgentData>} */\nconst agentToData = new WeakMap();\n/**\n * @typedef {API.Service} Service\n * @typedef {API.Receipt<any, any>} Receipt\n */\n/**\n * Creates a Ucanto connection for the w3access API\n *\n * Usage:\n *\n * ```js\n * import { connection } from '@storacha/access/agent'\n * ```\n *\n * @template {API.DID} T - DID method\n * @template {Record<string, any>} [S=Service]\n * @param {object} [options]\n * @param {API.Principal<T>} [options.principal] - w3access API Principal\n * @param {URL} [options.url] - w3access API URL\n * @param {API.Transport.Channel<S>} [options.channel] - Ucanto channel to use\n * @param {typeof fetch} [options.fetch] - Fetch implementation to use\n * @returns {API.ConnectionView<S>}\n */\nexport function connection(options = {}) {\n    return Client.connect({\n        id: options.principal ?? PRINCIPAL,\n        codec: CAR.outbound,\n        channel: options.channel ??\n            HTTP.open({\n                url: options.url ?? new URL(HOST),\n                method: 'POST',\n                fetch: options.fetch ?? globalThis.fetch.bind(globalThis),\n            }),\n    });\n}\n/**\n * Agent\n *\n * Usage:\n *\n * ```js\n * import { Agent } from '@storacha/access/agent'\n * ```\n *\n * @template {Record<string, any>} [S=Service]\n */\nexport class Agent {\n    /** @type {import('./agent-data.js').AgentData} */\n    #data;\n    /**\n     * DIDs the service is known by, including the primary. They are used by\n     * `invoke` and `invokeAndExecute` to scope session proofs to just the service\n     * DID or it's aliases.\n     *\n     * @type {Set<API.DID>}\n     */\n    #serviceIdentities;\n    /**\n     * @param {import('./agent-data.js').AgentData} data - Agent data\n     * @param {import('./types.js').AgentOptions<S>} [options]\n     */\n    constructor(data, options = {}) {\n        /** @type { Client.Channel<S> & { url?: URL } | undefined } */\n        const channel = options.connection?.channel;\n        this.url = options.url ?? channel?.url ?? new URL(HOST);\n        this.connection =\n            options.connection ??\n                connection({\n                    principal: options.servicePrincipal,\n                    url: this.url,\n                });\n        this.#data = data;\n        agentToData.set(this, this.#data);\n        const primary = this.connection.id;\n        const serviceIdentities = new Set(options.serviceIdentities);\n        // If the default identities includes the configured primary identity then\n        // add them to the service identities list.\n        if (IDENTITIES.includes(primary.did())) {\n            for (const id of IDENTITIES) {\n                serviceIdentities.add(id);\n            }\n        }\n        // Add the primary identity if not already in service identities.\n        if (!serviceIdentities.has(primary.did())) {\n            serviceIdentities.add(primary.did());\n        }\n        this.#serviceIdentities = serviceIdentities;\n    }\n    /**\n     * Create a new Agent instance, optionally with the passed initialization data.\n     *\n     * @template {Record<string, any>} [R=Service]\n     * @param {Partial<import('./types.js').AgentDataModel>} [init]\n     * @param {import('./types.js').AgentOptions<R> & import('./types.js').AgentDataOptions} [options]\n     */\n    static async create(init, options = {}) {\n        const data = await AgentData.create(init, options);\n        return new Agent(data, options);\n    }\n    /**\n     * Instantiate an Agent from pre-exported agent data.\n     *\n     * @template {Record<string, any>} [R=Service]\n     * @param {import('./types.js').AgentDataExport} raw\n     * @param {import('./types.js').AgentOptions<R> & import('./types.js').AgentDataOptions} [options]\n     */\n    static from(raw, options = {}) {\n        const data = AgentData.fromExport(raw, options);\n        return new Agent(data, options);\n    }\n    get issuer() {\n        return this.#data.principal;\n    }\n    get meta() {\n        return this.#data.meta;\n    }\n    get spaces() {\n        return this.#data.spaces;\n    }\n    did() {\n        return this.#data.principal.did();\n    }\n    /**\n     * Add a proof to the agent store.\n     *\n     * @param {API.Delegation} delegation\n     */\n    async addProof(delegation) {\n        return await this.addProofs([delegation]);\n    }\n    /**\n     * Adds set of proofs to the agent store.\n     *\n     * @param {Iterable<API.Delegation>} delegations\n     */\n    async addProofs(delegations) {\n        for (const proof of delegations) {\n            await this.#data.addDelegation(proof, { audience: this.meta });\n        }\n        await this.removeExpiredDelegations();\n        return {};\n    }\n    /**\n     * Query the delegations store for all the delegations matching the capabilities provided.\n     *\n     * @param {API.CapabilityQuery[]} [caps]\n     */\n    #delegations(caps) {\n        const _caps = new Set(caps);\n        /** @type {Array<{ delegation: API.Delegation, meta: API.DelegationMeta }>} */\n        const values = [];\n        for (const [, value] of this.#data.delegations) {\n            // check expiration\n            if (!isExpired(value.delegation) && // check if delegation can be used\n                !isTooEarly(value.delegation)) {\n                // check if we need to filter for caps\n                if (Array.isArray(caps) && caps.length > 0) {\n                    for (const cap of _caps) {\n                        if (canDelegateCapability(value.delegation, cap)) {\n                            values.push(value);\n                        }\n                    }\n                }\n                else {\n                    values.push(value);\n                }\n            }\n        }\n        return values;\n    }\n    /**\n     * Clean up any expired delegations.\n     */\n    async removeExpiredDelegations() {\n        for (const [, value] of this.#data.delegations) {\n            if (isExpired(value.delegation)) {\n                await this.#data.removeDelegation(value.delegation.cid);\n            }\n        }\n    }\n    /**\n     * Revoke a delegation by CID.\n     *\n     * If the delegation was issued by this agent (and therefore is stored in the\n     * delegation store) you can just pass the CID. If not, or if the current agent's\n     * delegation store no longer contains the delegation, you MUST pass a chain of\n     * proofs that proves your authority to revoke this delegation as `options.proofs`.\n     *\n     * @param {API.UCANLink} delegationCID\n     * @param {object} [options]\n     * @param {API.Delegation[]} [options.proofs]\n     */\n    async revoke(delegationCID, options = {}) {\n        const additionalProofs = options.proofs ?? [];\n        // look for the identified delegation in the delegation store and the passed proofs\n        const delegation = [...this.delegations(), ...additionalProofs].find((delegation) => delegation.cid.equals(delegationCID));\n        if (!delegation) {\n            return {\n                error: new Error(`could not find delegation ${delegationCID.toString()} - please include the delegation in options.proofs`),\n            };\n        }\n        const receipt = await this.invokeAndExecute(UCAN.revoke, {\n            // per https://github.com/storacha/upload-service/blob/main/packages/capabilities/src/ucan.js#L38C6-L38C6 the resource here should be\n            // the current issuer - using the space DID here works for simple cases but falls apart when a delegee tries to revoke a delegation\n            // they have re-delegated, since they don't have \"ucan/revoke\" capabilities on the space\n            with: this.issuer.did(),\n            nb: {\n                ucan: delegation.cid,\n            },\n            proofs: [delegation, ...additionalProofs],\n        });\n        return receipt.out;\n    }\n    /**\n     * Get all the proofs matching the capabilities.\n     *\n     * Proofs are delegations with an audience matching agent DID, or with an\n     * audience matching the session DID.\n     *\n     * Proof of session will also be included in the returned proofs if any\n     * proofs matching the passed capabilities require it.\n     *\n     * @param {API.CapabilityQuery[]} [caps] - Capabilities to filter by. Empty or undefined caps with return all the proofs.\n     * @param {object} [options]\n     * @param {API.DID|API.DID[]} [options.sessionProofIssuer] - only include session proofs for these issuer(s)\n     */\n    proofs(caps, options) {\n        /** @type {Map<string, API.Delegation<API.Capabilities>>} */\n        const authorizations = new Map();\n        for (const { delegation } of this.#delegations(caps)) {\n            if (delegation.audience.did() === this.issuer.did()) {\n                authorizations.set(delegation.cid.toString(), delegation);\n            }\n        }\n        /** @type {Set<API.DID>} */\n        const sessionProofIssuers = new Set();\n        if (options?.sessionProofIssuer) {\n            const ids = Array.isArray(options.sessionProofIssuer)\n                ? options.sessionProofIssuer\n                : [options.sessionProofIssuer];\n            for (const id of ids) {\n                sessionProofIssuers.add(id);\n            }\n        }\n        // now let's add any session proofs that refer to those authorizations\n        const sessions = getSessionProofs(this.#data);\n        for (const proof of [...authorizations.values()]) {\n            const proofsByIssuer = sessions[proof.asCID.toString()] ?? {};\n            const sessionProofs = [];\n            if (sessionProofIssuers.size > 0) {\n                for (const id of sessionProofIssuers) {\n                    const proofs = proofsByIssuer[id];\n                    if (proofs)\n                        sessionProofs.push(...proofs);\n                }\n            }\n            else {\n                sessionProofs.push(...Object.values(proofsByIssuer).flat());\n            }\n            for (const sessionProof of sessionProofs) {\n                authorizations.set(sessionProof.cid.toString(), sessionProof);\n            }\n        }\n        return [...authorizations.values()];\n    }\n    /**\n     * Get delegations created by the agent for others.\n     *\n     * @param {API.CapabilityQuery[]} [caps] - Capabilities to filter by. Empty or undefined caps with return all the delegations.\n     */\n    delegations(caps) {\n        const arr = [];\n        for (const { delegation } of this.delegationsWithMeta(caps)) {\n            arr.push(delegation);\n        }\n        return arr;\n    }\n    /**\n     * Get delegations created by the agent for others and their metadata.\n     *\n     * @param {API.CapabilityQuery[]} [caps] - Capabilities to filter by. Empty or undefined caps with return all the delegations.\n     */\n    delegationsWithMeta(caps) {\n        const arr = [];\n        for (const value of this.#delegations(caps)) {\n            const { delegation } = value;\n            const isSession = delegation.capabilities.some((c) => c.can === attest.can);\n            if (!isSession && delegation.audience.did() !== this.issuer.did()) {\n                arr.push(value);\n            }\n        }\n        return arr;\n    }\n    /**\n     * Creates a space signer and a delegation to the agent\n     *\n     * @param {string} name\n     * @param {object} [options]\n     * @param {API.SpaceAccessType} [options.access] - The access type for the space. Defaults to { type: 'public' }.\n     */\n    async createSpace(name, { access } = {}) {\n        return await Space.generate({ name, access, agent: this });\n    }\n    /**\n     * @param {string} secret\n     * @param {object} options\n     * @param {string} options.name - The name of the space.\n     * @param {API.SpaceAccessType} [options.access] - The access type for the space. Defaults to { type: 'public' }.\n     */\n    async recoverSpace(secret, { name, access }) {\n        return await Space.fromMnemonic(secret, { name, access, agent: this });\n    }\n    /**\n     * Import a space from a delegation.\n     *\n     * @param {API.Delegation} delegation\n     * @param {object} options\n     * @param {string} [options.name]\n     */\n    async importSpaceFromDelegation(delegation, { name = '' } = {}) {\n        const space = name === ''\n            ? Space.fromDelegation(delegation)\n            : Space.fromDelegation(delegation).withName(name);\n        // Store space metadata preserving all properties\n        this.#data.spaces.set(space.did(), {\n            ...space.meta,\n            name: space.name,\n            access: space.access,\n        });\n        await this.addProof(space.delegation);\n        // if we do not have a current space, make this one current\n        if (!this.currentSpace()) {\n            await this.setCurrentSpace(space.did());\n        }\n        return space;\n    }\n    /**\n     * Sets the current selected space\n     *\n     * Other methods will default to use the current space if no resource is defined\n     *\n     * @param {API.SpaceDID} space\n     */\n    async setCurrentSpace(space) {\n        if (!this.#data.spaces.has(space)) {\n            throw new Error(`Agent has no proofs for ${space}.`);\n        }\n        await this.#data.setCurrentSpace(space);\n        return space;\n    }\n    /**\n     * Get current space DID\n     */\n    currentSpace() {\n        return this.#data.currentSpace;\n    }\n    /**\n     * Get current space DID, proofs and abilities\n     */\n    currentSpaceWithMeta() {\n        if (!this.#data.currentSpace) {\n            return;\n        }\n        const proofs = this.proofs([\n            {\n                can: 'space/info',\n                with: this.#data.currentSpace,\n            },\n        ]);\n        const caps = new Set();\n        for (const p of proofs) {\n            for (const cap of p.capabilities) {\n                caps.add(cap.can);\n            }\n        }\n        return {\n            did: this.#data.currentSpace,\n            proofs,\n            capabilities: [...caps],\n            meta: this.#data.spaces.get(this.#data.currentSpace),\n        };\n    }\n    /**\n     *\n     * @param {import('./types.js').DelegationOptions} options\n     */\n    async delegate(options) {\n        const space = this.currentSpaceWithMeta();\n        if (!space) {\n            throw new Error('no space selected.');\n        }\n        const caps = /** @type {API.Capabilities} */ (options.abilities.map((a) => {\n            return {\n                with: space.did,\n                can: a,\n            };\n        }));\n        // Verify agent can provide proofs for each requested capability\n        for (const cap of caps) {\n            if (!this.proofs([cap]).length) {\n                throw new Error(`cannot delegate capability ${cap.can} with ${cap.with}`);\n            }\n        }\n        const delegation = await delegate({\n            issuer: this.issuer,\n            capabilities: caps,\n            proofs: this.proofs(caps),\n            facts: [{ space: space.meta ?? {} }],\n            ...options,\n        });\n        await this.#data.addDelegation(delegation, {\n            audience: options.audienceMeta,\n        });\n        await this.removeExpiredDelegations();\n        return delegation;\n    }\n    /**\n     * Invoke and execute the given capability on the Access service connection\n     *\n     * ```js\n     *\n     * await agent.invokeAndExecute(Space.recover, {\n     *   nb: {\n     *     identity: 'mailto: email@gmail.com',\n     *   },\n     * })\n     *\n     * // sugar for\n     * const recoverInvocation = await agent.invoke(Space.recover, {\n     *   nb: {\n     *     identity: 'mailto: email@gmail.com',\n     *   },\n     * })\n     *\n     * await recoverInvocation.execute(agent.connection)\n     * ```\n     *\n     * @template {API.Ability} A\n     * @template {API.URI} R\n     * @template {API.Caveats} C\n     * @param {API.TheCapabilityParser<API.CapabilityMatch<A, R, C>>} cap\n     * @param {API.InvokeOptions<A, R, API.TheCapabilityParser<API.CapabilityMatch<A, R, C>>>} options\n     * @returns {Promise<API.InferReceipt<API.Capability<A, R, C>, S>>}\n     */\n    async invokeAndExecute(cap, options) {\n        const inv = await this.invoke(cap, options);\n        const out = inv.execute(/** @type {*} */ (this.connection));\n        return /** @type {*} */ (out);\n    }\n    /**\n     * Execute invocations on the agent's connection\n     *\n     * @example\n     * ```js\n     * const i1 = await agent.invoke(Space.info, {})\n     * const i2 = await agent.invoke(Space.recover, {\n     *   nb: {\n     *     identity: 'mailto:hello@storacha.network',\n     *   },\n     * })\n     *\n     * const results = await agent.execute2(i1, i2)\n     *\n     * ```\n     * @template {API.Capability} C\n     * @template {API.Tuple<API.ServiceInvocation<C, S>>} I\n     * @param {I} invocations\n     */\n    execute(...invocations) {\n        return this.connection.execute(...invocations);\n    }\n    /**\n     * Creates an invocation for the given capability with Agent's proofs, service, issuer and space.\n     *\n     * @example\n     * ```js\n     * const recoverInvocation = await agent.invoke(Space.recover, {\n     *   nb: {\n     *     identity: 'mailto: email@gmail.com',\n     *   },\n     * })\n     *\n     * await recoverInvocation.execute(agent.connection)\n     * // or\n     * await agent.execute(recoverInvocation)\n     * ```\n     *\n     * @template {API.Ability} A\n     * @template {API.URI} R\n     * @template {API.TheCapabilityParser<API.CapabilityMatch<A, R, C>>} CAP\n     * @template {API.Caveats} [C={}]\n     * @param {CAP} cap\n     * @param {import('./types.js').InvokeOptions<A, R, CAP>} options\n     */\n    async invoke(cap, options) {\n        const audience = options.audience || this.connection.id;\n        const space = options.with || this.currentSpace();\n        if (!space) {\n            throw new Error('No space or resource selected, you need pass a resource.');\n        }\n        const proofs = [\n            ...(options.proofs || []),\n            ...this.proofs([\n                {\n                    with: space,\n                    can: cap.can,\n                },\n            ], {\n                sessionProofIssuer: this.#serviceIdentities.has(audience.did())\n                    ? [...this.#serviceIdentities]\n                    : audience.did(),\n            }),\n        ];\n        if (proofs.length === 0 && options.with !== this.did()) {\n            throw new Error(`no proofs available for resource ${space} and ability ${cap.can}`);\n        }\n        const inv = invoke({\n            ...options,\n            audience,\n            // @ts-ignore\n            capability: cap.create({\n                with: space,\n                nb: 'nb' in options ? options.nb : undefined,\n            }),\n            issuer: this.issuer,\n            proofs: [...proofs],\n            nonce: options.nonce,\n        });\n        return /** @type {API.IssuedInvocationView<API.InferInvokedCapability<CAP>>} */ (inv);\n    }\n    /**\n     * Get Space information from Access service\n     *\n     * @param {API.URI<\"did:\">} [space]\n     * @param {object} [options]\n     * @param {string} [options.nonce]\n     */\n    async getSpaceInfo(space, options) {\n        const _space = space || this.currentSpace();\n        if (!_space) {\n            throw new Error('No space selected, you need pass a resource.');\n        }\n        const inv = await this.invokeAndExecute(Capabilities.info, {\n            ...options,\n            with: _space,\n        });\n        if (inv.out.error) {\n            throw inv.out.error;\n        }\n        return /** @type {import('./types.js').SpaceInfoResult} */ (inv.out.ok);\n    }\n}\n/**\n * Given a list of delegations, add to agent data spaces list.\n *\n * @deprecated - trying to remove explicit space tracking from Agent/AgentData\n * in favor of functions that derive the space set from access.delegations\n *\n * @template {Record<string, any>} [S=Service]\n * @param {Agent<S>} agent\n * @param {API.Delegation[]} delegations\n */\nexport async function addSpacesFromDelegations(agent, delegations) {\n    const data = agentToData.get(agent);\n    if (!data) {\n        throw Object.assign(new Error(`cannot determine AgentData for Agent`), {\n            agent: agent,\n        });\n    }\n    // spaces we find along the way.\n    const spaces = new Map();\n    // only consider ucans with this agent as the audience\n    const ours = delegations.filter((x) => x.audience.did() === agent.did());\n    // space names are stored as facts in proofs in the special `ucan:*` delegation from email to agent.\n    const ucanStars = ours.filter((x) => x.capabilities[0].can === '*' && x.capabilities[0].with === 'ucan:*');\n    for (const delegation of ucanStars) {\n        for (const proof of delegation.proofs) {\n            if (!isDelegation(proof) ||\n                !proof.capabilities[0].with.startsWith('did:key')) {\n                continue;\n            }\n            const space = Space.fromDelegation(proof);\n            spaces.set(space.did(), space.meta);\n        }\n    }\n    // Find any other spaces the user may have access to\n    for (const delegation of ours) {\n        // TODO: we need a more robust way to determine which spaces a user has access to\n        // it may or may not involve look at delegations\n        const allows = ucanto.Delegation.allows(delegation);\n        for (const [resource, value] of Object.entries(allows)) {\n            // If we discovered a delegation to any DID, we add it to the spaces list.\n            if (resource.startsWith('did:key') && Object.keys(value).length > 0) {\n                if (!spaces.has(resource)) {\n                    spaces.set(resource, {});\n                }\n            }\n        }\n    }\n    for (const [did, meta] of spaces) {\n        await data.addSpace(did, meta);\n    }\n}\n/**\n * Stores given delegations in the agent's data store and adds discovered spaces\n * to the agent's space list.\n *\n * @param {Agent} agent\n * @param {object} authorization\n * @param {API.Delegation[]} authorization.proofs\n * @returns {Promise<API.Result<API.Unit, Error>>}\n */\nexport const importAuthorization = async (agent, { proofs }) => {\n    try {\n        await agent.addProofs(proofs);\n        await addSpacesFromDelegations(agent, proofs);\n        return { ok: {} };\n    }\n    catch (error) {\n        return /** @type {{error:Error}} */ ({ error });\n    }\n};\n//# sourceMappingURL=agent.js.map"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2827, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/drivers/indexeddb.js"],"sourcesContent":["import defer from 'p-defer';\n/**\n * @template T\n * @typedef {import('./types.js').Driver<T>} Driver\n */\nconst STORE_NAME = 'AccessStore';\nconst DATA_ID = 1;\n/**\n * Driver implementation for the browser.\n *\n * Usage:\n *\n * ```js\n * import { IndexedDBDriver } from '@storacha/access/drivers/indexeddb'\n * ```\n *\n * @template T\n * @implements {Driver<T>}\n */\nexport class IndexedDBDriver {\n    /** @type {string} */\n    #dbName;\n    /** @type {number|undefined} */\n    #dbVersion;\n    /** @type {string} */\n    #dbStoreName;\n    /** @type {IDBDatabase|undefined} */\n    #db;\n    /** @type {boolean} */\n    #autoOpen;\n    /**\n     * @param {string} dbName\n     * @param {object} [options]\n     * @param {number} [options.dbVersion]\n     * @param {string} [options.dbStoreName]\n     * @param {boolean} [options.autoOpen]\n     */\n    constructor(dbName, options = {}) {\n        this.#dbName = dbName;\n        this.#dbVersion = options.dbVersion;\n        this.#dbStoreName = options.dbStoreName ?? STORE_NAME;\n        this.#autoOpen = options.autoOpen ?? true;\n    }\n    /** @returns {Promise<IDBDatabase>} */\n    async #getOpenDB() {\n        if (!this.#db) {\n            if (!this.#autoOpen)\n                throw new Error('Store is not open');\n            await this.open();\n        }\n        // @ts-expect-error open sets this.#db\n        return this.#db;\n    }\n    async open() {\n        const db = this.#db;\n        if (db)\n            return;\n        /** @type {import('p-defer').DeferredPromise<void>} */\n        const { resolve, reject, promise } = defer();\n        const openReq = indexedDB.open(this.#dbName, this.#dbVersion);\n        openReq.addEventListener('upgradeneeded', () => {\n            const db = openReq.result;\n            db.createObjectStore(this.#dbStoreName, { keyPath: 'id' });\n        });\n        openReq.addEventListener('success', () => {\n            this.#db = openReq.result;\n            resolve();\n        });\n        openReq.addEventListener('error', () => reject(openReq.error));\n        return promise;\n    }\n    async close() {\n        const db = this.#db;\n        if (!db)\n            throw new Error('Store is not open');\n        db.close();\n        this.#db = undefined;\n    }\n    /** @param {T} data */\n    async save(data) {\n        const db = await this.#getOpenDB();\n        const putData = withObjectStore(db, 'readwrite', this.#dbStoreName, async (store) => {\n            /** @type {import('p-defer').DeferredPromise<void>} */\n            const { resolve, reject, promise } = defer();\n            const putReq = store.put({ id: DATA_ID, ...data });\n            putReq.addEventListener('success', () => resolve());\n            putReq.addEventListener('error', () => reject(new Error('failed to query DB', { cause: putReq.error })));\n            return promise;\n        });\n        return await putData();\n    }\n    async load() {\n        const db = await this.#getOpenDB();\n        const getData = withObjectStore(db, 'readonly', this.#dbStoreName, async (store) => {\n            /** @type {import('p-defer').DeferredPromise<T|undefined>} */\n            const { resolve, reject, promise } = defer();\n            const getReq = store.get(DATA_ID);\n            getReq.addEventListener('success', () => resolve(getReq.result));\n            getReq.addEventListener('error', () => reject(new Error('failed to query DB', { cause: getReq.error })));\n            return promise;\n        });\n        return await getData();\n    }\n    async reset() {\n        const db = await this.#getOpenDB();\n        const clear = withObjectStore(db, 'readwrite', this.#dbStoreName, (s) => {\n            /** @type {import('p-defer').DeferredPromise<void>} */\n            const { resolve, reject, promise } = defer();\n            const req = s.clear();\n            req.addEventListener('success', () => {\n                resolve();\n            });\n            req.addEventListener('error', () => reject(new Error('failed to query DB', { cause: req.error })));\n            return promise;\n        });\n        await clear();\n    }\n}\n/**\n * @template T\n * @param {IDBDatabase} db\n * @param {IDBTransactionMode} txnMode\n * @param {string} storeName\n * @param {(s: IDBObjectStore) => Promise<T>} fn\n * @returns\n */\nfunction withObjectStore(db, txnMode, storeName, fn) {\n    return async () => {\n        const tx = db.transaction(storeName, txnMode);\n        /** @type {import('p-defer').DeferredPromise<T>} */\n        const { resolve, reject, promise } = defer();\n        /** @type {T} */\n        let result;\n        tx.addEventListener('complete', () => resolve(result));\n        tx.addEventListener('abort', () => reject(tx.error || new Error('transaction aborted')));\n        tx.addEventListener('error', () => reject(new Error('transaction error', { cause: tx.error })));\n        try {\n            result = await fn(tx.objectStore(storeName));\n            tx.commit();\n        }\n        catch (error) {\n            reject(error);\n            tx.abort();\n        }\n        return promise;\n    };\n}\n//# sourceMappingURL=indexeddb.js.map"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2964, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/access/dist/stores/store-indexeddb.js"],"sourcesContent":["import { IndexedDBDriver } from '../drivers/indexeddb.js';\n/**\n * Store implementation for the browser.\n *\n * Usage:\n *\n * ```js\n * import { StoreIndexedDB } from '@storacha/access/stores/store-indexeddb'\n * ```\n *\n * @extends {IndexedDBDriver<import('../types.js').AgentDataExport>}\n */\nexport class StoreIndexedDB extends IndexedDBDriver {\n}\n//# sourceMappingURL=store-indexeddb.js.map"],"names":[],"mappings":";;;;AAAA;;AAYO,MAAM,uBAAuB,0LAAe;AACnD,EACA,2CAA2C","ignoreList":[0]}},
    {"offset": {"line": 2985, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/did-mailto/dist/types.js"],"sourcesContent":["export {};\n//# sourceMappingURL=types.js.map"],"names":[],"mappings":";;CACA,iCAAiC","ignoreList":[0]}},
    {"offset": {"line": 2992, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/did-mailto/dist/index.js"],"sourcesContent":["export * from './types.js';\n/**\n * create a did:mailto from an email address\n *\n * @param {import(\"./types.js\").EmailAddress} email\n * @returns {import(\"./types.js\").DidMailto}\n */\nexport function fromEmail(email) {\n    const { domain, local } = parseEmail(email);\n    const did = /** @type {const} */ (`did:mailto:${encodeURIComponent(domain)}:${encodeURIComponent(local)}`);\n    return did;\n}\n/**\n * @param {import(\"./types.js\").DidMailto} did\n * @returns {import(\"./types.js\").EmailAddress}\n */\nexport function toEmail(did) {\n    const parts = did.split(':');\n    if (parts[1] !== 'mailto') {\n        throw new Error(`DID ${did} is not a mailto did.`);\n    }\n    return `${decodeURIComponent(parts[3])}@${decodeURIComponent(parts[2])}`;\n}\n/**\n * given a string, if it is an EmailAddress, return it, otherwise throw an error.\n * Use this to parse string input to `EmailAddress` type to pass to `fromEmail` (when needed).\n * This is not meant to be a general RFC5322 (et al) email address validator, which would be more expensive.\n *\n * @param {string} input\n * @returns {import(\"./types.js\").EmailAddress}\n */\nexport function email(input) {\n    const { domain, local } = parseEmail(input);\n    /** @type {import(\"./types.js\").EmailAddress} */\n    const emailAddress = `${local}@${domain}`;\n    return emailAddress;\n}\n/**\n * parse a did mailto from a string\n *\n * @param {string} input\n * @returns {import(\"./types.js\").DidMailto}\n */\nexport function fromString(input) {\n    const colonParts = input.split(':');\n    if (colonParts.length !== 4) {\n        throw new TypeError(`expected did:mailto to have 4 colon-delimited segments, but got ${colonParts.length}`);\n    }\n    const [domain, local] = [colonParts[2], colonParts[3]];\n    return `did:mailto:${domain}:${local}`;\n}\n/**\n * @param {string} email\n */\nfunction parseEmail(email) {\n    const atParts = email.split('@');\n    if (atParts.length < 2) {\n        throw new TypeError(`expected at least 2 @-delimited segments, but got ${atParts.length}`);\n    }\n    const domain = atParts.at(-1) ?? '';\n    const local = atParts.slice(0, -1).join('@');\n    return { domain, local };\n}\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAOO,SAAS,UAAU,KAAK;IAC3B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,WAAW;IACrC,MAAM,MAA4B,CAAC,WAAW,EAAE,mBAAmB,QAAQ,CAAC,EAAE,mBAAmB,QAAQ;IACzG,OAAO;AACX;AAKO,SAAS,QAAQ,GAAG;IACvB,MAAM,QAAQ,IAAI,KAAK,CAAC;IACxB,IAAI,KAAK,CAAC,EAAE,KAAK,UAAU;QACvB,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,IAAI,qBAAqB,CAAC;IACrD;IACA,OAAO,GAAG,mBAAmB,KAAK,CAAC,EAAE,EAAE,CAAC,EAAE,mBAAmB,KAAK,CAAC,EAAE,GAAG;AAC5E;AASO,SAAS,MAAM,KAAK;IACvB,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,WAAW;IACrC,8CAA8C,GAC9C,MAAM,eAAe,GAAG,MAAM,CAAC,EAAE,QAAQ;IACzC,OAAO;AACX;AAOO,SAAS,WAAW,KAAK;IAC5B,MAAM,aAAa,MAAM,KAAK,CAAC;IAC/B,IAAI,WAAW,MAAM,KAAK,GAAG;QACzB,MAAM,IAAI,UAAU,CAAC,gEAAgE,EAAE,WAAW,MAAM,EAAE;IAC9G;IACA,MAAM,CAAC,QAAQ,MAAM,GAAG;QAAC,UAAU,CAAC,EAAE;QAAE,UAAU,CAAC,EAAE;KAAC;IACtD,OAAO,CAAC,WAAW,EAAE,OAAO,CAAC,EAAE,OAAO;AAC1C;AACA;;CAEC,GACD,SAAS,WAAW,KAAK;IACrB,MAAM,UAAU,MAAM,KAAK,CAAC;IAC5B,IAAI,QAAQ,MAAM,GAAG,GAAG;QACpB,MAAM,IAAI,UAAU,CAAC,kDAAkD,EAAE,QAAQ,MAAM,EAAE;IAC7F;IACA,MAAM,SAAS,QAAQ,EAAE,CAAC,CAAC,MAAM;IACjC,MAAM,QAAQ,QAAQ,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;IACxC,OAAO;QAAE;QAAQ;IAAM;AAC3B,EACA,iCAAiC","ignoreList":[0]}},
    {"offset": {"line": 3075, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/filecoin-client/dist/service.js"],"sourcesContent":["import * as DID from '@ipld/dag-ucan/did';\n/**\n * @typedef {import('./types.js').SERVICE} Service\n * @typedef {import('./types.js').ServiceConfig} ServiceConfig\n */\n/**\n * @type {Record<Service, ServiceConfig>}\n */\nexport const services = {\n    STOREFRONT: {\n        url: new URL('https://up.storacha.network'),\n        principal: DID.parse('did:web:up.storacha.network'),\n    },\n    AGGREGATOR: {\n        url: new URL('https://aggregator.web3.storage'),\n        principal: DID.parse('did:web:web3.storage'),\n    },\n    DEALER: {\n        url: new URL('https://dealer.web3.storage'),\n        principal: DID.parse('did:web:web3.storage'),\n    },\n    DEAL_TRACKER: {\n        url: new URL('https://tracker.web3.storage'),\n        principal: DID.parse('did:web:web3.storage'),\n    },\n};\n//# sourceMappingURL=service.js.map"],"names":[],"mappings":";;;;AAAA;;AAQO,MAAM,WAAW;IACpB,YAAY;QACR,KAAK,IAAI,IAAI;QACb,WAAW,+JAAS,CAAC;IACzB;IACA,YAAY;QACR,KAAK,IAAI,IAAI;QACb,WAAW,+JAAS,CAAC;IACzB;IACA,QAAQ;QACJ,KAAK,IAAI,IAAI;QACb,WAAW,+JAAS,CAAC;IACzB;IACA,cAAc;QACV,KAAK,IAAI,IAAI;QACb,WAAW,+JAAS,CAAC;IACzB;AACJ,GACA,mCAAmC","ignoreList":[0]}},
    {"offset": {"line": 3103, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/filecoin-client/dist/storefront.js"],"sourcesContent":["import { connect } from '@ucanto/client';\nimport { CAR, HTTP } from '@ucanto/transport';\nimport * as Storefront from '@storacha/capabilities/filecoin/storefront';\nimport { services } from './service.js';\n/**\n * @typedef {import('./types.js').StorefrontService} StorefrontService\n * @typedef {import('@ucanto/interface').ConnectionView<StorefrontService>} ConnectionView\n */\n/** @type {ConnectionView} */\nexport const connection = connect({\n    id: services.STOREFRONT.principal,\n    codec: CAR.outbound,\n    channel: HTTP.open({\n        url: services.STOREFRONT.url,\n        method: 'POST',\n    }),\n});\n/**\n * The `filecoin/offer` task can be executed to request storing a content piece\n * in Filecoin. It issues a signed receipt of the execution result.\n *\n * A receipt for successful execution will contain an effect, linking to a\n * `filecoin/submit` task that will complete asynchronously.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#filecoinoffer\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('multiformats').UnknownLink} content\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {import('./types.js').RequestOptions<StorefrontService>} [options]\n */\nexport async function filecoinOffer({ issuer, with: resource, proofs, audience }, content, piece, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Storefront.filecoinOffer.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.STOREFRONT.principal,\n        with: resource,\n        nb: {\n            content,\n            piece,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    return await invocation.execute(conn);\n}\n/**\n * The `filecoin/submit` task is an _effect_ linked from successful execution\n * of a `filecoin/offer` task, it is executed to issue a receipt for the\n * success or failure of the task.\n *\n * A receipt for successful execution indicates that the offered piece has been\n * submitted to the pipeline. In this case the receipt will contain an effect,\n * linking to a `piece/offer` task that will complete asynchronously.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#filecoinsubmit\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('multiformats').UnknownLink} content\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {import('./types.js').RequestOptions<StorefrontService>} [options]\n */\nexport async function filecoinSubmit({ issuer, with: resource, proofs, audience }, content, piece, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Storefront.filecoinSubmit.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.STOREFRONT.principal,\n        with: resource,\n        nb: {\n            content,\n            piece,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    return await invocation.execute(conn);\n}\n/**\n * The `filecoin/accept` task is an _effect_ linked from successful execution\n * of a `filecoin/offer` task, it is executed to issue a receipt for the\n * success or failure of the task.\n *\n * A receipt for successful execution indicates that the offered piece has been\n * accepted in a Filecoin deal. In this case the receipt will contain proofs\n * that the piece was included in an aggregate and deal.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#filecoinaccept\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('multiformats').UnknownLink} content\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {import('./types.js').RequestOptions<StorefrontService>} [options]\n */\nexport async function filecoinAccept({ issuer, with: resource, proofs, audience }, content, piece, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Storefront.filecoinAccept.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.STOREFRONT.principal,\n        with: resource,\n        nb: {\n            content,\n            piece,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    return await invocation.execute(conn);\n}\n/**\n * The `filecoin/info` task can be executed to request info about a content piece\n * in Filecoin. It issues a signed receipt of the execution result.\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {import('./types.js').RequestOptions<StorefrontService>} [options]\n */\nexport async function filecoinInfo({ issuer, with: resource, proofs, audience }, piece, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Storefront.filecoinInfo.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.STOREFRONT.principal,\n        with: resource,\n        nb: {\n            piece,\n        },\n        proofs,\n    });\n    return await invocation.execute(conn);\n}\n//# sourceMappingURL=storefront.js.map"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;;;;;AAMO,MAAM,aAAa,IAAA,qKAAO,EAAC;IAC9B,IAAI,kLAAQ,CAAC,UAAU,CAAC,SAAS;IACjC,OAAO,4LAAG,CAAC,QAAQ;IACnB,SAAS,+LAAI,CAAC,IAAI,CAAC;QACf,KAAK,kLAAQ,CAAC,UAAU,CAAC,GAAG;QAC5B,QAAQ;IACZ;AACJ;AAkBO,eAAe,cAAc,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IAC1G,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,gMAAwB,CAAC,MAAM,CAAC;QAC/C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;QACA,YAAY;IAChB;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC;AAoBO,eAAe,eAAe,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IAC3G,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,iMAAyB,CAAC,MAAM,CAAC;QAChD;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;QACA,YAAY;IAChB;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC;AAoBO,eAAe,eAAe,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IAC3G,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,iMAAyB,CAAC,MAAM,CAAC;QAChD;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;QACA,YAAY;IAChB;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC;AASO,eAAe,aAAa,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IAChG,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,+LAAuB,CAAC,MAAM,CAAC;QAC9C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;QACJ;QACA;IACJ;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC,EACA,sCAAsC","ignoreList":[0]}},
    {"offset": {"line": 3196, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/filecoin-client/dist/aggregator.js"],"sourcesContent":["import { connect } from '@ucanto/client';\nimport { CAR, HTTP } from '@ucanto/transport';\nimport * as Aggregator from '@storacha/capabilities/filecoin/aggregator';\nimport { services } from './service.js';\n/**\n * @typedef {import('./types.js').AggregatorService} AggregatorService\n * @typedef {import('@ucanto/interface').ConnectionView<AggregatorService>} ConnectionView\n */\n/** @type {ConnectionView} */\nexport const connection = connect({\n    id: services.AGGREGATOR.principal,\n    codec: CAR.outbound,\n    channel: HTTP.open({\n        url: services.AGGREGATOR.url,\n        method: 'POST',\n    }),\n});\n/**\n * The `piece/offer` task can be executed to request that a piece be aggregated\n * for inclusion in an upcoming an Filecoin deal. It issues a signed receipt\n * of the execution result. It is _also_ an effect linked from successful\n * execution of a `filecoin/submit` task.\n *\n * A receipt for successful execution will contain an effect, linking to a\n * `piece/accept` task that will complete asynchronously.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#pieceoffer\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {string} group\n * @param {import('./types.js').RequestOptions<AggregatorService>} [options]\n */\nexport async function pieceOffer({ issuer, with: resource, proofs, audience }, piece, group, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Aggregator.pieceOffer.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.AGGREGATOR.principal,\n        with: resource,\n        nb: {\n            piece,\n            group,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    return await invocation.execute(conn);\n}\n/**\n * The `piece/accept` task is an _effect_ linked from successful execution of a\n * `piece/offer` task, it is executed to issue a receipt for the success or\n * failure of the task.\n *\n * A receipt for successful execution indicates that the offered piece was\n * included in an aggregate. In this case the receipt will contain the\n * aggregate piece CID and a proof that the piece was included in the\n * aggregate. It also includes an effect, linking to an `aggregate/offer` task\n * that will complete asynchronously.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#pieceaccept\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {string} group\n * @param {import('./types.js').RequestOptions<AggregatorService>} [options]\n */\nexport async function pieceAccept({ issuer, with: resource, proofs, audience }, piece, group, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Aggregator.pieceAccept.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.AGGREGATOR.principal,\n        with: resource,\n        nb: {\n            piece,\n            group,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    return await invocation.execute(conn);\n}\n//# sourceMappingURL=aggregator.js.map"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;;;;;AAMO,MAAM,aAAa,IAAA,qKAAO,EAAC;IAC9B,IAAI,kLAAQ,CAAC,UAAU,CAAC,SAAS;IACjC,OAAO,4LAAG,CAAC,QAAQ;IACnB,SAAS,+LAAI,CAAC,IAAI,CAAC;QACf,KAAK,kLAAQ,CAAC,UAAU,CAAC,GAAG;QAC5B,QAAQ;IACZ;AACJ;AAoBO,eAAe,WAAW,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IACrG,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,6LAAqB,CAAC,MAAM,CAAC;QAC5C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;QACA,YAAY;IAChB;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC;AAsBO,eAAe,YAAY,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IACtG,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,8LAAsB,CAAC,MAAM,CAAC;QAC7C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;QACA,YAAY;IAChB;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC,EACA,sCAAsC","ignoreList":[0]}},
    {"offset": {"line": 3257, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/filecoin-client/dist/dealer.js"],"sourcesContent":["import { connect } from '@ucanto/client';\nimport { CAR, HTTP } from '@ucanto/transport';\nimport { CBOR } from '@ucanto/core';\nimport * as Dealer from '@storacha/capabilities/filecoin/dealer';\nimport { services } from './service.js';\n/**\n * @typedef {import('./types.js').DealerService} DealerService\n * @typedef {import('@ucanto/interface').ConnectionView<DealerService>} ConnectionView\n */\n/** @type {ConnectionView} */\nexport const connection = connect({\n    id: services.DEALER.principal,\n    codec: CAR.outbound,\n    channel: HTTP.open({\n        url: services.DEALER.url,\n        method: 'POST',\n    }),\n});\n/**\n * The `aggregate/offer` task can be executed to request an aggregate be added\n * to a deal with a Storage Provider. It issues a signed receipt of the\n * execution result. It is _also_ an effect linked from successful execution of\n * a `piece/accept` task.\n *\n * A receipt for successful execution will contain an effect, linking to an\n * `aggregate/accept` task that will complete asynchronously.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#aggregateoffer\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('@web3-storage/data-segment').PieceLink} aggregate\n * @param {import('@web3-storage/data-segment').PieceLink[]} pieces\n * @param {import('./types.js').RequestOptions<DealerService>} [options]\n */\nexport async function aggregateOffer({ issuer, with: resource, proofs, audience }, aggregate, pieces, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const block = await CBOR.write(pieces);\n    const invocation = Dealer.aggregateOffer.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.AGGREGATOR.principal,\n        with: resource,\n        nb: {\n            aggregate,\n            pieces: block.cid,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    invocation.attach(block);\n    return await invocation.execute(conn);\n}\n/**\n * The `aggregate/accept` task is an _effect_ linked from successful execution\n * of a `aggregate/offer` task, it is executed to issue a receipt for the\n * success or failure of the task.\n *\n * A receipt for successful execution indicates that an aggregate has been\n * accepted for inclusion in a Filecoin deal. In this case the receipt will\n * contain proofs that the piece was included in an aggregate and deal.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure, as well as multiple effects, linking to\n * `piece/offer` tasks that will retry _valid_ pieces and complete\n * asynchronously.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#aggregateaccept\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('@web3-storage/data-segment').PieceLink} aggregate\n * @param {import('@ucanto/interface').Link} pieces\n * @param {import('./types.js').RequestOptions<DealerService>} [options]\n */\nexport async function aggregateAccept({ issuer, with: resource, proofs, audience }, aggregate, pieces, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = Dealer.aggregateAccept.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.AGGREGATOR.principal,\n        with: resource,\n        nb: {\n            aggregate,\n            pieces,\n        },\n        proofs,\n        expiration: Infinity,\n    });\n    return await invocation.execute(conn);\n}\n//# sourceMappingURL=dealer.js.map"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;;;;;;AAMO,MAAM,aAAa,IAAA,qKAAO,EAAC;IAC9B,IAAI,kLAAQ,CAAC,MAAM,CAAC,SAAS;IAC7B,OAAO,4LAAG,CAAC,QAAQ;IACnB,SAAS,+LAAI,CAAC,IAAI,CAAC;QACf,KAAK,kLAAQ,CAAC,MAAM,CAAC,GAAG;QACxB,QAAQ;IACZ;AACJ;AAoBO,eAAe,eAAe,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC;IAC9G,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,QAAQ,MAAM,0LAAI,CAAC,KAAK,CAAC;IAC/B,MAAM,aAAa,6LAAqB,CAAC,MAAM,CAAC;QAC5C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA,QAAQ,MAAM,GAAG;QACrB;QACA;QACA,YAAY;IAChB;IACA,WAAW,MAAM,CAAC;IAClB,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC;AAsBO,eAAe,gBAAgB,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC;IAC/G,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,8LAAsB,CAAC,MAAM,CAAC;QAC7C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,UAAU,CAAC,SAAS;QACnD,MAAM;QACN,IAAI;YACA;YACA;QACJ;QACA;QACA,YAAY;IAChB;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC,EACA,kCAAkC","ignoreList":[0]}},
    {"offset": {"line": 3323, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/filecoin-client/dist/deal-tracker.js"],"sourcesContent":["import { connect } from '@ucanto/client';\nimport { CAR, HTTP } from '@ucanto/transport';\nimport * as DealTracker from '@storacha/capabilities/filecoin/deal-tracker';\nimport { services } from './service.js';\n/**\n * @typedef {import('./types.js').DealTrackerService} DealTrackerService\n * @typedef {import('@ucanto/interface').ConnectionView<DealTrackerService>} ConnectionView\n */\n/** @type {ConnectionView} */\nexport const connection = connect({\n    id: services.DEAL_TRACKER.principal,\n    codec: CAR.outbound,\n    channel: HTTP.open({\n        url: services.DEAL_TRACKER.url,\n        method: 'POST',\n    }),\n});\n/**\n * The `deal/info` task can be executed to request deal information for a given\n * piece. It issues a signed receipt of the execution result.\n *\n * A receipt for successful execution will contain details of deals the\n * provided piece CID is currently active in.\n *\n * Otherwise the task is failed and the receipt will contain details of the\n * reason behind the failure.\n *\n * @see https://github.com/storacha/specs/blob/main/w3-filecoin.md#dealinfo\n *\n * @param {import('./types.js').InvocationConfig} conf - Configuration\n * @param {import('@web3-storage/data-segment').PieceLink} piece\n * @param {import('./types.js').RequestOptions<DealTrackerService>} [options]\n */\nexport async function dealInfo({ issuer, with: resource, proofs, audience }, piece, options = {}) {\n    /* c8 ignore next */\n    const conn = options.connection ?? connection;\n    const invocation = DealTracker.dealInfo.invoke({\n        issuer,\n        /* c8 ignore next */\n        audience: audience ?? services.DEAL_TRACKER.principal,\n        with: resource,\n        nb: {\n            piece,\n        },\n        proofs,\n    });\n    return await invocation.execute(conn);\n}\n//# sourceMappingURL=deal-tracker.js.map"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;;;;;AAMO,MAAM,aAAa,IAAA,qKAAO,EAAC;IAC9B,IAAI,kLAAQ,CAAC,YAAY,CAAC,SAAS;IACnC,OAAO,4LAAG,CAAC,QAAQ;IACnB,SAAS,+LAAI,CAAC,IAAI,CAAC;QACf,KAAK,kLAAQ,CAAC,YAAY,CAAC,GAAG;QAC9B,QAAQ;IACZ;AACJ;AAiBO,eAAe,SAAS,EAAE,MAAM,EAAE,MAAM,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;IAC5F,kBAAkB,GAClB,MAAM,OAAO,QAAQ,UAAU,IAAI;IACnC,MAAM,aAAa,gMAAoB,CAAC,MAAM,CAAC;QAC3C;QACA,kBAAkB,GAClB,UAAU,YAAY,kLAAQ,CAAC,YAAY,CAAC,SAAS;QACrD,MAAM;QACN,IAAI;YACA;QACJ;QACA;IACJ;IACA,OAAO,MAAM,WAAW,OAAO,CAAC;AACpC,EACA,wCAAwC","ignoreList":[0]}},
    {"offset": {"line": 3365, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/filecoin-client/dist/index.js"],"sourcesContent":["export * as Storefront from './storefront.js';\nexport * as Aggregator from './aggregator.js';\nexport * as Dealer from './dealer.js';\nexport * as DealTracker from './deal-tracker.js';\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":";AAAA;AACA;AACA;AACA,iTACA,iCAAiC","ignoreList":[0]}},
    {"offset": {"line": 3387, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/dist/api.js"],"sourcesContent":["export {};\n//# sourceMappingURL=api.js.map"],"names":[],"mappings":";;CACA,+BAA+B","ignoreList":[0]}},
    {"offset": {"line": 3394, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/dist/digest-map.js"],"sourcesContent":["import * as API from './api.js';\nimport { base58btc } from 'multiformats/bases/base58';\n/** @type {WeakMap<Uint8Array, string>} */\nconst cache = new WeakMap();\n/** @param {API.MultihashDigest} digest */\nconst toBase58String = (digest) => {\n    let str = cache.get(digest.bytes);\n    if (!str) {\n        str = base58btc.encode(digest.bytes);\n        cache.set(digest.bytes, str);\n    }\n    return str;\n};\n/**\n * @template {API.MultihashDigest} Key\n * @template Value\n * @implements {Map<Key, Value>}\n */\nexport class DigestMap {\n    /** @type {Map<string, [Key, Value]>} */\n    #data;\n    /**\n     * @param {Array<[Key, Value]>} [entries]\n     */\n    constructor(entries) {\n        this.#data = new Map();\n        for (const [k, v] of entries ?? []) {\n            this.set(k, v);\n        }\n    }\n    get [Symbol.toStringTag]() {\n        return 'DigestMap';\n    }\n    clear() {\n        this.#data.clear();\n    }\n    /**\n     * @param {Key} key\n     * @returns {boolean}\n     */\n    delete(key) {\n        const mhstr = toBase58String(key);\n        return this.#data.delete(mhstr);\n    }\n    /**\n     * @param {(value: Value, key: Key, map: Map<Key, Value>) => void} callbackfn\n     * @param {any} [thisArg]\n     */\n    forEach(callbackfn, thisArg) {\n        for (const [k, v] of this.#data.values()) {\n            callbackfn.call(thisArg, v, k, this);\n        }\n    }\n    /**\n     * @param {Key} key\n     * @returns {Value|undefined}\n     */\n    get(key) {\n        const data = this.#data.get(toBase58String(key));\n        if (data)\n            return data[1];\n    }\n    /**\n     * @param {Key} key\n     * @returns {boolean}\n     */\n    has(key) {\n        return this.#data.has(toBase58String(key));\n    }\n    /**\n     * @param {Key} key\n     * @param {Value} value\n     */\n    set(key, value) {\n        this.#data.set(toBase58String(key), [key, value]);\n        return this;\n    }\n    /** @returns {number} */\n    get size() {\n        return this.#data.size;\n    }\n    /** @returns */\n    [Symbol.iterator]() {\n        return this.entries();\n    }\n    /** @returns {IterableIterator<[Key, Value]>} */\n    *entries() {\n        yield* this.#data.values();\n    }\n    /** @returns {IterableIterator<Key>} */\n    *keys() {\n        for (const [k] of this.#data.values()) {\n            yield k;\n        }\n    }\n    /** @returns {IterableIterator<Value>} */\n    *values() {\n        for (const [, v] of this.#data.values()) {\n            yield v;\n        }\n    }\n}\n//# sourceMappingURL=digest-map.js.map"],"names":[],"mappings":";;;;AAAA;AACA;;;AACA,wCAAwC,GACxC,MAAM,QAAQ,IAAI;AAClB,wCAAwC,GACxC,MAAM,iBAAiB,CAAC;IACpB,IAAI,MAAM,MAAM,GAAG,CAAC,OAAO,KAAK;IAChC,IAAI,CAAC,KAAK;QACN,MAAM,8KAAS,CAAC,MAAM,CAAC,OAAO,KAAK;QACnC,MAAM,GAAG,CAAC,OAAO,KAAK,EAAE;IAC5B;IACA,OAAO;AACX;AAMO,MAAM;IACT,sCAAsC,GACtC,CAAA,IAAK,CAAC;IACN;;KAEC,GACD,YAAY,OAAO,CAAE;QACjB,IAAI,CAAC,CAAA,IAAK,GAAG,IAAI;QACjB,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,WAAW,EAAE,CAAE;YAChC,IAAI,CAAC,GAAG,CAAC,GAAG;QAChB;IACJ;IACA,IAAI,CAAC,OAAO,WAAW,CAAC,GAAG;QACvB,OAAO;IACX;IACA,QAAQ;QACJ,IAAI,CAAC,CAAA,IAAK,CAAC,KAAK;IACpB;IACA;;;KAGC,GACD,OAAO,GAAG,EAAE;QACR,MAAM,QAAQ,eAAe;QAC7B,OAAO,IAAI,CAAC,CAAA,IAAK,CAAC,MAAM,CAAC;IAC7B;IACA;;;KAGC,GACD,QAAQ,UAAU,EAAE,OAAO,EAAE;QACzB,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,CAAA,IAAK,CAAC,MAAM,GAAI;YACtC,WAAW,IAAI,CAAC,SAAS,GAAG,GAAG,IAAI;QACvC;IACJ;IACA;;;KAGC,GACD,IAAI,GAAG,EAAE;QACL,MAAM,OAAO,IAAI,CAAC,CAAA,IAAK,CAAC,GAAG,CAAC,eAAe;QAC3C,IAAI,MACA,OAAO,IAAI,CAAC,EAAE;IACtB;IACA;;;KAGC,GACD,IAAI,GAAG,EAAE;QACL,OAAO,IAAI,CAAC,CAAA,IAAK,CAAC,GAAG,CAAC,eAAe;IACzC;IACA;;;KAGC,GACD,IAAI,GAAG,EAAE,KAAK,EAAE;QACZ,IAAI,CAAC,CAAA,IAAK,CAAC,GAAG,CAAC,eAAe,MAAM;YAAC;YAAK;SAAM;QAChD,OAAO,IAAI;IACf;IACA,sBAAsB,GACtB,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,CAAA,IAAK,CAAC,IAAI;IAC1B;IACA,aAAa,GACb,CAAC,OAAO,QAAQ,CAAC,GAAG;QAChB,OAAO,IAAI,CAAC,OAAO;IACvB;IACA,8CAA8C,GAC9C,CAAC,UAAU;QACP,OAAO,IAAI,CAAC,CAAA,IAAK,CAAC,MAAM;IAC5B;IACA,qCAAqC,GACrC,CAAC,OAAO;QACJ,KAAK,MAAM,CAAC,EAAE,IAAI,IAAI,CAAC,CAAA,IAAK,CAAC,MAAM,GAAI;YACnC,MAAM;QACV;IACJ;IACA,uCAAuC,GACvC,CAAC,SAAS;QACN,KAAK,MAAM,GAAG,EAAE,IAAI,IAAI,CAAC,CAAA,IAAK,CAAC,MAAM,GAAI;YACrC,MAAM;QACV;IACJ;AACJ,EACA,sCAAsC","ignoreList":[0]}},
    {"offset": {"line": 3489, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/dist/sharded-dag-index.js"],"sourcesContent":["import * as API from './api.js';\nimport { CAR, ok, error, Schema, Failure } from '@ucanto/core';\nimport { compare } from 'uint8arrays';\nimport * as dagCBOR from '@ipld/dag-cbor';\nimport * as Digest from 'multiformats/hashes/digest';\nimport * as Link from 'multiformats/link';\nimport { sha256 } from 'multiformats/hashes/sha2';\nimport { DigestMap } from './digest-map.js';\nexport const version = 'index/sharded/dag@0.1';\nexport const ShardedDAGIndexSchema = Schema.variant({\n    [version]: Schema.struct({\n        /** DAG root. */\n        content: Schema.link(),\n        /** Shards the DAG can be found in. */\n        shards: Schema.array(Schema.link()),\n    }),\n});\nexport const MultihashSchema = Schema.bytes();\nexport const BlobIndexSchema = Schema.tuple([\n    MultihashSchema,\n    Schema.array(\n    /** multihash bytes, offset, length. */\n    Schema.tuple([\n        MultihashSchema,\n        Schema.tuple([Schema.number(), Schema.number()]),\n    ])),\n]);\n/**\n * @param {Uint8Array} archive\n * @returns {API.Result<API.ShardedDAGIndexView, API.DecodeFailure|API.UnknownFormat>}\n */\nexport const extract = (archive) => {\n    const { roots, blocks } = CAR.decode(archive);\n    if (!roots.length) {\n        return error(new UnknownFormat('missing root block'));\n    }\n    const { code } = roots[0].cid;\n    if (code !== dagCBOR.code) {\n        return error(new UnknownFormat(`unexpected root CID codec: 0x${code.toString(16)}`));\n    }\n    return view({ root: roots[0], blocks });\n};\n/**\n * @param {object} source\n * @param {API.IPLDBlock} source.root\n * @param {Map<string, API.IPLDBlock>} source.blocks\n * @returns {API.Result<API.ShardedDAGIndexView, API.DecodeFailure|API.UnknownFormat>}\n */\nexport const view = ({ root, blocks }) => {\n    const [version, dagIndexData] = ShardedDAGIndexSchema.match(dagCBOR.decode(root.bytes));\n    switch (version) {\n        case version: {\n            const dagIndex = create(dagIndexData.content);\n            for (const shardLink of dagIndexData.shards) {\n                const shard = blocks.get(shardLink.toString());\n                if (!shard) {\n                    return error(new DecodeFailure(`missing shard block: ${shardLink}`));\n                }\n                const blobIndexData = BlobIndexSchema.from(dagCBOR.decode(shard.bytes));\n                const blobIndex = new DigestMap();\n                for (const [digest, [offset, length]] of blobIndexData[1]) {\n                    blobIndex.set(Digest.decode(digest), [offset, length]);\n                }\n                dagIndex.shards.set(Digest.decode(blobIndexData[0]), blobIndex);\n            }\n            return ok(dagIndex);\n        }\n        default:\n            return error(new UnknownFormat(`unknown index version: ${version}`));\n    }\n};\n/** @implements {API.ShardedDAGIndexView} */\nclass ShardedDAGIndex {\n    #content;\n    #shards;\n    /** @param {API.UnknownLink} content */\n    constructor(content) {\n        this.#content = content;\n        /** @type {DigestMap<API.ShardDigest, API.Position>} */\n        this.#shards = new DigestMap();\n    }\n    get content() {\n        return this.#content;\n    }\n    get shards() {\n        return this.#shards;\n    }\n    /**\n     * @param {API.ShardDigest} shard\n     * @param {API.SliceDigest} slice\n     * @param {API.Position} pos\n     */\n    setSlice(shard, slice, pos) {\n        let index = this.#shards.get(shard);\n        if (!index) {\n            index = new DigestMap();\n            this.#shards.set(shard, index);\n        }\n        index.set(slice, pos);\n    }\n    archive() {\n        return archive(this);\n    }\n}\nexport class UnknownFormat extends Failure {\n    #reason;\n    /** @param {string} [reason] */\n    constructor(reason) {\n        super();\n        this.name = /** @type {const} */ ('UnknownFormat');\n        this.#reason = reason;\n    }\n    describe() {\n        return this.#reason ?? 'unknown format';\n    }\n}\nexport class DecodeFailure extends Failure {\n    #reason;\n    /** @param {string} [reason] */\n    constructor(reason) {\n        super();\n        this.name = /** @type {const} */ ('DecodeFailure');\n        this.#reason = reason;\n    }\n    describe() {\n        return this.#reason ?? 'failed to decode';\n    }\n}\n/**\n * @param {API.UnknownLink} content\n * @returns {API.ShardedDAGIndexView}\n */\nexport const create = (content) => new ShardedDAGIndex(content);\n/**\n * @param {API.ShardedDAGIndex} model\n * @returns {Promise<API.Result<Uint8Array, API.EncodeFailure>>}\n */\nexport const archive = async (model) => {\n    const roots = [];\n    const blocks = new Map();\n    try {\n        const shards = [...model.shards.entries()].sort((a, b) => compare(a[0].digest, b[0].digest));\n        const index = {\n            content: model.content,\n            shards: /** @type {API.Link[]} */ ([]),\n        };\n        for (const s of shards) {\n            const slices = [...s[1].entries()]\n                .sort((a, b) => compare(a[0].digest, b[0].digest))\n                .map((e) => [e[0].bytes, e[1]]);\n            const bytes = dagCBOR.encode([s[0].bytes, slices]);\n            const digest = await sha256.digest(bytes);\n            const cid = Link.create(dagCBOR.code, digest);\n            blocks.set(cid.toString(), { cid, bytes });\n            index.shards.push(cid);\n        }\n        const bytes = dagCBOR.encode({ [version]: index });\n        const digest = await sha256.digest(bytes);\n        const cid = Link.create(dagCBOR.code, digest);\n        roots.push({ cid, bytes });\n    }\n    catch ( /** @type {any} */err) {\n        return error(\n        /** @type {API.EncodeFailure} */ ({\n            name: 'EncodeFailure',\n            message: `encoding DAG: ${err.message}`,\n            stack: err.stack,\n        }));\n    }\n    try {\n        return ok(CAR.encode({ roots, blocks }));\n    }\n    catch ( /** @type {any} */err) {\n        return error(\n        /** @type {API.EncodeFailure} */ ({\n            name: 'EncodeFailure',\n            message: `encoding CAR: ${err.message}`,\n            stack: err.stack,\n        }));\n    }\n};\n//# sourceMappingURL=sharded-dag-index.js.map"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3705, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/dist/util.js"],"sourcesContent":["import { CARReaderStream } from 'carstream';\nimport { sha256 } from 'multiformats/hashes/sha2';\nimport * as API from './api.js';\nimport { create } from './sharded-dag-index.js';\n/**\n * Create a sharded DAG index by indexing blocks in the passed CAR shards.\n *\n * @param {API.UnknownLink} content\n * @param {Uint8Array[]} shards\n * @returns {Promise<API.ShardedDAGIndexView>}\n */\nexport const fromShardArchives = async (content, shards) => {\n    const index = create(content);\n    for (const s of shards) {\n        const digest = await sha256.digest(s);\n        await new ReadableStream({\n            pull: (c) => {\n                c.enqueue(s);\n                c.close();\n            },\n        })\n            .pipeThrough(new CARReaderStream())\n            .pipeTo(new WritableStream({\n            write({ cid, blockOffset, blockLength }) {\n                index.setSlice(digest, cid.multihash, [blockOffset, blockLength]);\n            },\n        }));\n    }\n    return index;\n};\n/**\n * Indexes a sharded DAG\n *\n * @param {import('multiformats').Link} root\n * @param {import('@storacha/capabilities/types').CARLink[]} shards\n * @param {Array<Map<API.SliceDigest, API.Position>>} shardIndexes\n */\nexport async function indexShardedDAG(root, shards, shardIndexes) {\n    const index = create(root);\n    for (const [i, shard] of shards.entries()) {\n        const slices = shardIndexes[i];\n        index.shards.set(shard.multihash, slices);\n    }\n    return await index.archive();\n}\n//# sourceMappingURL=util.js.map"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;AACA;;;;;AAQO,MAAM,oBAAoB,OAAO,SAAS;IAC7C,MAAM,QAAQ,IAAA,2LAAM,EAAC;IACrB,KAAK,MAAM,KAAK,OAAQ;QACpB,MAAM,SAAS,MAAM,qLAAM,CAAC,MAAM,CAAC;QACnC,MAAM,IAAI,eAAe;YACrB,MAAM,CAAC;gBACH,EAAE,OAAO,CAAC;gBACV,EAAE,KAAK;YACX;QACJ,GACK,WAAW,CAAC,IAAI,gKAAe,IAC/B,MAAM,CAAC,IAAI,eAAe;YAC3B,OAAM,EAAE,GAAG,EAAE,WAAW,EAAE,WAAW,EAAE;gBACnC,MAAM,QAAQ,CAAC,QAAQ,IAAI,SAAS,EAAE;oBAAC;oBAAa;iBAAY;YACpE;QACJ;IACJ;IACA,OAAO;AACX;AAQO,eAAe,gBAAgB,IAAI,EAAE,MAAM,EAAE,YAAY;IAC5D,MAAM,QAAQ,IAAA,2LAAM,EAAC;IACrB,KAAK,MAAM,CAAC,GAAG,MAAM,IAAI,OAAO,OAAO,GAAI;QACvC,MAAM,SAAS,YAAY,CAAC,EAAE;QAC9B,MAAM,MAAM,CAAC,GAAG,CAAC,MAAM,SAAS,EAAE;IACtC;IACA,OAAO,MAAM,MAAM,OAAO;AAC9B,EACA,gCAAgC","ignoreList":[0]}},
    {"offset": {"line": 3752, "column": 0}, "map": {"version":3,"sources":["file:///home/driemworks/fangorn/website/node_modules/%40storacha/blob-index/dist/index.js"],"sourcesContent":["export * as ShardedDAGIndex from './sharded-dag-index.js';\nexport * from './digest-map.js';\nexport { indexShardedDAG } from './util.js';\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":";AAAA;AACA;AACA,oRACA,iCAAiC","ignoreList":[0]}}]
}